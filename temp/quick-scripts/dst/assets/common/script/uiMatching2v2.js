
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/common/script/uiMatching2v2.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'a9812MCL65DLZS0a4bbkylN', 'uiMatching2v2');
// common/script/uiMatching2v2.js

"use strict";

var uiPanel = require("uiPanel");

var mvs = require("Matchvs");

var GLB = require("Glb");

cc.Class({
  "extends": uiPanel,
  properties: {
    playerIcons: [cc.Node]
  },
  onLoad: function onLoad() {
    this._super();

    this.nodeDict["quit"].on("click", this.leaveRoom, this);
    mvs.response.joinRoomResponse = this.joinRoomResponse.bind(this);
    mvs.response.joinRoomNotify = this.joinRoomNotify.bind(this);
    mvs.response.leaveRoomResponse = this.leaveRoomResponse.bind(this);
    mvs.response.leaveRoomNotify = this.leaveRoomNotify.bind(this);
  },
  joinRandomRoom: function joinRandomRoom() {
    var result = null;

    if (GLB.matchType === GLB.RANDOM_MATCH) {
      result = mvs.engine.joinRandomRoom(GLB.MAX_PLAYER_COUNT, '');

      if (result !== 0) {
        console.log('进入房间失败,错误码:' + result);
      }
    } else if (GLB.matchType === GLB.PROPERTY_MATCH) {
      var matchinfo = new mvs.MatchInfo();
      matchinfo.maxPlayer = GLB.MAX_PLAYER_COUNT;
      matchinfo.mode = 0;
      matchinfo.canWatch = 0;
      matchinfo.tags = GLB.tagsInfo;
      result = mvs.engine.joinRoomWithProperties(matchinfo, "joinRoomWithProperties");

      if (result !== 0) {
        console.log('进入房间失败,错误码:' + result);
      }
    }
  },
  startGame: function startGame() {
    console.log('游戏即将开始');
    cc.director.loadScene('game');
  },
  joinRoomResponse: function joinRoomResponse(data) {
    if (data.status !== 200) {
      console.log('进入房间失败,异步回调错误码: ' + data.status);
    } else {
      console.log('进入房间成功');
      console.log('房间号: ' + data.roomInfo.roomID);
    }

    GLB.roomId = data.roomInfo.roomID;
    var userIds = [GLB.userInfo.id];
    console.log('房间用户: ' + userIds);
    var playerIcon = null;

    for (var j = 0; j < data.roomUserInfoList.length; j++) {
      playerIcon = this.playerIcons[j].getComponent('playerIcon');

      if (playerIcon && !playerIcon.userInfo) {
        playerIcon.setData(data.roomUserInfoList[j]);

        if (GLB.userInfo.id !== data.roomUserInfoList[j].userId) {
          userIds.push(data.roomUserInfoList[j].userId);
        }
      }
    }

    for (var i = 0; i < this.playerIcons.length; i++) {
      playerIcon = this.playerIcons[i].getComponent('playerIcon');

      if (playerIcon && !playerIcon.userInfo) {
        playerIcon.setData(GLB.userInfo);
        break;
      }
    }

    GLB.playerUserIds = userIds;

    if (userIds.length >= GLB.MAX_PLAYER_COUNT) {
      var result = mvs.engine.joinOver("");
      console.log("发出关闭房间的通知");

      if (result !== 0) {
        console.log("关闭房间失败，错误码：", result);
      }

      GLB.playerUserIds = userIds;
    }
  },
  joinRoomNotify: function joinRoomNotify(data) {
    console.log("joinRoomNotify, roomUserInfo:" + JSON.stringify(data.roomUserInfo));
    var playerIcon = null;

    for (var j = 0; j < this.playerIcons.length; j++) {
      playerIcon = this.playerIcons[j].getComponent('playerIcon');

      if (playerIcon && !playerIcon.userInfo) {
        playerIcon.setData(data.roomUserInfo);
        break;
      }
    }
  },
  leaveRoom: function leaveRoom() {
    mvs.engine.leaveRoom("");
  },
  leaveRoomNotify: function leaveRoomNotify(data) {
    if (GLB.roomId === data.leaveRoomInfo.roomID) {
      for (var i = 0; i < this.playerIcons.length; i++) {
        var playerIcon = this.playerIcons[i].getComponent('playerIcon');

        if (playerIcon && playerIcon.userInfo && playerIcon.playerId === data.leaveRoomInfo.userId) {
          playerIcon.init();
          break;
        }
      }
    }
  },
  leaveRoomResponse: function leaveRoomResponse(data) {
    if (data.leaveRoomRsp.status === 200) {
      console.log("离开房间成功");

      for (var i = 0; i < this.playerIcons.length; i++) {
        var playerIcon = this.playerIcons[i].getComponent('playerIcon');

        if (playerIcon) {
          playerIcon.init();
          break;
        }
      }

      uiFunc.closeUI(this.node.name);
      this.node.destroy();
    } else {
      console.log("离开房间失败");
    }
  },
  joinOverResponse: function joinOverResponse(data) {
    if (data.joinOverRsp.status === 200) {
      console.log("关闭房间成功");
      this.notifyGameStart();
    } else {
      console.log("关闭房间失败，回调通知错误码：", data.joinOverRsp.status);
    }
  },
  notifyGameStart: function notifyGameStart() {
    GLB.isRoomOwner = true;
    var event = {
      action: GLB.GAME_START_EVENT,
      userIds: GLB.playerUserIds
    };
    mvs.engine.sendEvent(JSON.stringify(event));
  },
  onDestroy: function onDestroy() {
    clientEvent.on(clientEvent.eventType.joinRoomResponse, this.joinRoomResponse, this);
    clientEvent.on(clientEvent.eventType.joinRoomNotify, this.joinRoomNotify, this);
    clientEvent.on(clientEvent.eventType.leaveRoomResponse, this.leaveRoomResponse, this);
    clientEvent.on(clientEvent.eventType.leaveRoomNotify, this.leaveRoomNotify, this);
    clientEvent.on(clientEvent.eventType.joinOverResponse, this.joinOverResponse, this);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2Fzc2V0cy9jb21tb24vc2NyaXB0L2Fzc2V0cy9jb21tb24vc2NyaXB0L3VpTWF0Y2hpbmcydjIuanMiXSwibmFtZXMiOlsidWlQYW5lbCIsInJlcXVpcmUiLCJtdnMiLCJHTEIiLCJjYyIsIkNsYXNzIiwicHJvcGVydGllcyIsInBsYXllckljb25zIiwiTm9kZSIsIm9uTG9hZCIsIl9zdXBlciIsIm5vZGVEaWN0Iiwib24iLCJsZWF2ZVJvb20iLCJyZXNwb25zZSIsImpvaW5Sb29tUmVzcG9uc2UiLCJiaW5kIiwiam9pblJvb21Ob3RpZnkiLCJsZWF2ZVJvb21SZXNwb25zZSIsImxlYXZlUm9vbU5vdGlmeSIsImpvaW5SYW5kb21Sb29tIiwicmVzdWx0IiwibWF0Y2hUeXBlIiwiUkFORE9NX01BVENIIiwiZW5naW5lIiwiTUFYX1BMQVlFUl9DT1VOVCIsImNvbnNvbGUiLCJsb2ciLCJQUk9QRVJUWV9NQVRDSCIsIm1hdGNoaW5mbyIsIk1hdGNoSW5mbyIsIm1heFBsYXllciIsIm1vZGUiLCJjYW5XYXRjaCIsInRhZ3MiLCJ0YWdzSW5mbyIsImpvaW5Sb29tV2l0aFByb3BlcnRpZXMiLCJzdGFydEdhbWUiLCJkaXJlY3RvciIsImxvYWRTY2VuZSIsImRhdGEiLCJzdGF0dXMiLCJyb29tSW5mbyIsInJvb21JRCIsInJvb21JZCIsInVzZXJJZHMiLCJ1c2VySW5mbyIsImlkIiwicGxheWVySWNvbiIsImoiLCJyb29tVXNlckluZm9MaXN0IiwibGVuZ3RoIiwiZ2V0Q29tcG9uZW50Iiwic2V0RGF0YSIsInVzZXJJZCIsInB1c2giLCJpIiwicGxheWVyVXNlcklkcyIsImpvaW5PdmVyIiwiSlNPTiIsInN0cmluZ2lmeSIsInJvb21Vc2VySW5mbyIsImxlYXZlUm9vbUluZm8iLCJwbGF5ZXJJZCIsImluaXQiLCJsZWF2ZVJvb21Sc3AiLCJ1aUZ1bmMiLCJjbG9zZVVJIiwibm9kZSIsIm5hbWUiLCJkZXN0cm95Iiwiam9pbk92ZXJSZXNwb25zZSIsImpvaW5PdmVyUnNwIiwibm90aWZ5R2FtZVN0YXJ0IiwiaXNSb29tT3duZXIiLCJldmVudCIsImFjdGlvbiIsIkdBTUVfU1RBUlRfRVZFTlQiLCJzZW5kRXZlbnQiLCJvbkRlc3Ryb3kiLCJjbGllbnRFdmVudCIsImV2ZW50VHlwZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFELENBQXJCOztBQUNBLElBQUlDLEdBQUcsR0FBR0QsT0FBTyxDQUFDLFNBQUQsQ0FBakI7O0FBQ0EsSUFBSUUsR0FBRyxHQUFHRixPQUFPLENBQUMsS0FBRCxDQUFqQjs7QUFDQUcsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxhQUFTTCxPQURKO0FBRUxNLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxXQUFXLEVBQUUsQ0FBQ0gsRUFBRSxDQUFDSSxJQUFKO0FBREwsR0FGUDtBQU1MQyxFQUFBQSxNQU5LLG9CQU1JO0FBQ0wsU0FBS0MsTUFBTDs7QUFDQSxTQUFLQyxRQUFMLENBQWMsTUFBZCxFQUFzQkMsRUFBdEIsQ0FBeUIsT0FBekIsRUFBa0MsS0FBS0MsU0FBdkMsRUFBa0QsSUFBbEQ7QUFFQVgsSUFBQUEsR0FBRyxDQUFDWSxRQUFKLENBQWFDLGdCQUFiLEdBQWdDLEtBQUtBLGdCQUFMLENBQXNCQyxJQUF0QixDQUEyQixJQUEzQixDQUFoQztBQUNBZCxJQUFBQSxHQUFHLENBQUNZLFFBQUosQ0FBYUcsY0FBYixHQUE4QixLQUFLQSxjQUFMLENBQW9CRCxJQUFwQixDQUF5QixJQUF6QixDQUE5QjtBQUNBZCxJQUFBQSxHQUFHLENBQUNZLFFBQUosQ0FBYUksaUJBQWIsR0FBaUMsS0FBS0EsaUJBQUwsQ0FBdUJGLElBQXZCLENBQTRCLElBQTVCLENBQWpDO0FBQ0FkLElBQUFBLEdBQUcsQ0FBQ1ksUUFBSixDQUFhSyxlQUFiLEdBQStCLEtBQUtBLGVBQUwsQ0FBcUJILElBQXJCLENBQTBCLElBQTFCLENBQS9CO0FB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QUFDUkMsTUFBQUEsTUFBTSxFQUFFekUsR0FBRyxDQUFDMEUsZ0JBREo7QUFFUmhDLE1BQUFBLE9BQU8sRUFBRTFDLEdBQUcsQ0FBQ3NEO0FBRkwsS0FBWjtBQUlBdkQsSUFBQUEsR0FBRyxDQUFDc0IsTUFBSixDQUFXc0QsU0FBWCxDQUFxQm5CLElBQUksQ0FBQ0MsU0FBTCxDQUFlZSxLQUFmLENBQXJCO0FBQ0gsR0FoSkk7QUFrSkxJLEVBQUFBLFNBbEpLLHVCQWtKTztBQUNSQyxJQUFBQSxXQUFXLENBQUNwRSxFQUFaLENBQWVvRSxXQUFXLENBQUNDLFNBQVosQ0FBc0JsRSxnQkFBckMsRUFBdUQsS0FBS0EsZ0JBQTVELEVBQThFLElBQTlFO0FBQ0FpRSxJQUFBQSxXQUFXLENBQUNwRSxFQUFaLENBQWVvRSxXQUFXLENBQUNDLFNBQVosQ0FBc0JoRSxjQUFyQyxFQUFxRCxLQUFLQSxjQUExRCxFQUEwRSxJQUExRTtBQUNBK0QsSUFBQUEsV0FBVyxDQUFDcEUsRUFBWixDQUFlb0UsV0FBVyxDQUFDQyxTQUFaLENBQXNCL0QsaUJBQXJDLEVBQXdELEtBQUtBLGlCQUE3RCxFQUFnRixJQUFoRjtBQUNBOEQsSUFBQUEsV0FBVyxDQUFDcEUsRUFBWixDQUFlb0UsV0FBVyxDQUFDQyxTQUFaLENBQXNCOUQsZUFBckMsRUFBc0QsS0FBS0EsZUFBM0QsRUFBNEUsSUFBNUU7QUFDQTZELElBQUFBLFdBQVcsQ0FBQ3BFLEVBQVosQ0FBZW9FLFdBQVcsQ0FBQ0MsU0FBWixDQUFzQlYsZ0JBQXJDLEVBQXVELEtBQUtBLGdCQUE1RCxFQUE4RSxJQUE5RTtBQUNIO0FBeEpJLENBQVQiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4vLi4vYXNzZXRzL2NvbW1vbi9zY3JpcHQiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgdWlQYW5lbCA9IHJlcXVpcmUoXCJ1aVBhbmVsXCIpO1xudmFyIG12cyA9IHJlcXVpcmUoXCJNYXRjaHZzXCIpO1xudmFyIEdMQiA9IHJlcXVpcmUoXCJHbGJcIik7XG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogdWlQYW5lbCxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHBsYXllckljb25zOiBbY2MuTm9kZV1cbiAgICB9LFxuXG4gICAgb25Mb2FkKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLm5vZGVEaWN0W1wicXVpdFwiXS5vbihcImNsaWNrXCIsIHRoaXMubGVhdmVSb29tLCB0aGlzKTtcblxuICAgICAgICBtdnMucmVzcG9uc2Uuam9pblJvb21SZXNwb25zZSA9IHRoaXMuam9pblJvb21SZXNwb25zZS5iaW5kKHRoaXMpO1xuICAgICAgICBtdnMucmVzcG9uc2Uuam9pblJvb21Ob3RpZnkgPSB0aGlzLmpvaW5Sb29tTm90aWZ5LmJpbmQodGhpcyk7XG4gICAgICAgIG12cy5yZXNwb25zZS5sZWF2ZVJvb21SZXNwb25zZSA9IHRoaXMubGVhdmVSb29tUmVzcG9uc2UuYmluZCh0aGlzKTtcbiAgICAgICAgbXZzLnJlc3BvbnNlLmxlYXZlUm9vbU5vdGlmeSA9IHRoaXMubGVhdmVSb29tTm90aWZ5LmJpbmQodGhpcyk7XG4gICAgfSxcblxuICAgIGpvaW5SYW5kb21Sb29tOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IG51bGw7XG4gICAgICAgIGlmIChHTEIubWF0Y2hUeXBlID09PSBHTEIuUkFORE9NX01BVENIKSB7XG4gICAgICAgICAgICByZXN1bHQgPSBtdnMuZW5naW5lLmpvaW5SYW5kb21Sb29tKEdMQi5NQVhfUExBWUVSX0NPVU5ULCAnJyk7XG4gICAgICAgICAgICBpZiAocmVzdWx0ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+i/m+WFpeaIv+mXtOWksei0pSzplJnor6/noIE6JyArIHJlc3VsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoR0xCLm1hdGNoVHlwZSA9PT0gR0xCLlBST1BFUlRZX01BVENIKSB7XG4gICAgICAgICAgICB2YXIgbWF0Y2hpbmZvID0gbmV3IG12cy5NYXRjaEluZm8oKTtcbiAgICAgICAgICAgIG1hdGNoaW5mby5tYXhQbGF5ZXIgPSBHTEIuTUFYX1BMQVlFUl9DT1VOVDtcbiAgICAgICAgICAgIG1hdGNoaW5mby5tb2RlID0gMDtcbiAgICAgICAgICAgIG1hdGNoaW5mby5jYW5XYXRjaCA9IDA7XG4gICAgICAgICAgICBtYXRjaGluZm8udGFncyA9IEdMQi50YWdzSW5mbztcbiAgICAgICAgICAgIHJlc3VsdCA9IG12cy5lbmdpbmUuam9pblJvb21XaXRoUHJvcGVydGllcyhtYXRjaGluZm8sIFwiam9pblJvb21XaXRoUHJvcGVydGllc1wiKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQgIT09IDApIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn6L+b5YWl5oi/6Ze05aSx6LSlLOmUmeivr+eggTonICsgcmVzdWx0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzdGFydEdhbWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zb2xlLmxvZygn5ri45oiP5Y2z5bCG5byA5aeLJyk7XG4gICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZSgnZ2FtZScpO1xuICAgIH0sXG5cbiAgICBqb2luUm9vbVJlc3BvbnNlOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIGlmIChkYXRhLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygn6L+b5YWl5oi/6Ze05aSx6LSlLOW8guatpeWbnuiwg+mUmeivr+eggTogJyArIGRhdGEuc3RhdHVzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfov5vlhaXmiL/pl7TmiJDlip8nKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfmiL/pl7Tlj7c6ICcgKyBkYXRhLnJvb21JbmZvLnJvb21JRCk7XG4gICAgICAgIH1cbiAgICAgICAgR0xCLnJvb21JZCA9IGRhdGEucm9vbUluZm8ucm9vbUlEO1xuICAgICAgICB2YXIgdXNlcklkcyA9IFtHTEIudXNlckluZm8uaWRdXG4gICAgICAgIGNvbnNvbGUubG9nKCfmiL/pl7TnlKjmiLc6ICcgKyB1c2VySWRzKTtcblxuICAgICAgICB2YXIgcGxheWVySWNvbiA9IG51bGw7XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZGF0YS5yb29tVXNlckluZm9MaXN0Lmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBwbGF5ZXJJY29uID0gdGhpcy5wbGF5ZXJJY29uc1tqXS5nZXRDb21wb25lbnQoJ3BsYXllckljb24nKTtcbiAgICAgICAgICAgIGlmIChwbGF5ZXJJY29uICYmICFwbGF5ZXJJY29uLnVzZXJJbmZvKSB7XG4gICAgICAgICAgICAgICAgcGxheWVySWNvbi5zZXREYXRhKGRhdGEucm9vbVVzZXJJbmZvTGlzdFtqXSk7XG4gICAgICAgICAgICAgICAgaWYgKEdMQi51c2VySW5mby5pZCAhPT0gZGF0YS5yb29tVXNlckluZm9MaXN0W2pdLnVzZXJJZCkge1xuICAgICAgICAgICAgICAgICAgICB1c2VySWRzLnB1c2goZGF0YS5yb29tVXNlckluZm9MaXN0W2pdLnVzZXJJZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXllckljb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBwbGF5ZXJJY29uID0gdGhpcy5wbGF5ZXJJY29uc1tpXS5nZXRDb21wb25lbnQoJ3BsYXllckljb24nKTtcbiAgICAgICAgICAgIGlmIChwbGF5ZXJJY29uICYmICFwbGF5ZXJJY29uLnVzZXJJbmZvKSB7XG4gICAgICAgICAgICAgICAgcGxheWVySWNvbi5zZXREYXRhKEdMQi51c2VySW5mbyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgR0xCLnBsYXllclVzZXJJZHMgPSB1c2VySWRzO1xuICAgICAgICBpZiAodXNlcklkcy5sZW5ndGggPj0gR0xCLk1BWF9QTEFZRVJfQ09VTlQpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBtdnMuZW5naW5lLmpvaW5PdmVyKFwiXCIpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCLlj5Hlh7rlhbPpl63miL/pl7TnmoTpgJrnn6VcIik7XG4gICAgICAgICAgICBpZiAocmVzdWx0ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCLlhbPpl63miL/pl7TlpLHotKXvvIzplJnor6/noIHvvJpcIiwgcmVzdWx0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgR0xCLnBsYXllclVzZXJJZHMgPSB1c2VySWRzO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGpvaW5Sb29tTm90aWZ5OiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiam9pblJvb21Ob3RpZnksIHJvb21Vc2VySW5mbzpcIiArIEpTT04uc3RyaW5naWZ5KGRhdGEucm9vbVVzZXJJbmZvKSk7XG4gICAgICAgIHZhciBwbGF5ZXJJY29uID0gbnVsbDtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLnBsYXllckljb25zLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBwbGF5ZXJJY29uID0gdGhpcy5wbGF5ZXJJY29uc1tqXS5nZXRDb21wb25lbnQoJ3BsYXllckljb24nKTtcbiAgICAgICAgICAgIGlmIChwbGF5ZXJJY29uICYmICFwbGF5ZXJJY29uLnVzZXJJbmZvKSB7XG4gICAgICAgICAgICAgICAgcGxheWVySWNvbi5zZXREYXRhKGRhdGEucm9vbVVzZXJJbmZvKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBsZWF2ZVJvb206IGZ1bmN0aW9uKCkge1xuICAgICAgICBtdnMuZW5naW5lLmxlYXZlUm9vbShcIlwiKTtcbiAgICB9LFxuXG4gICAgbGVhdmVSb29tTm90aWZ5OiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIGlmIChHTEIucm9vbUlkID09PSBkYXRhLmxlYXZlUm9vbUluZm8ucm9vbUlEKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWVySWNvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgcGxheWVySWNvbiA9IHRoaXMucGxheWVySWNvbnNbaV0uZ2V0Q29tcG9uZW50KCdwbGF5ZXJJY29uJyk7XG4gICAgICAgICAgICAgICAgaWYgKHBsYXllckljb24gJiYgcGxheWVySWNvbi51c2VySW5mbyAmJiBwbGF5ZXJJY29uLnBsYXllcklkID09PSBkYXRhLmxlYXZlUm9vbUluZm8udXNlcklkKSB7XG4gICAgICAgICAgICAgICAgICAgIHBsYXllckljb24uaW5pdCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgbGVhdmVSb29tUmVzcG9uc2U6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgaWYgKGRhdGEubGVhdmVSb29tUnNwLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIuemu+W8gOaIv+mXtOaIkOWKn1wiKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5ZXJJY29ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBwbGF5ZXJJY29uID0gdGhpcy5wbGF5ZXJJY29uc1tpXS5nZXRDb21wb25lbnQoJ3BsYXllckljb24nKTtcbiAgICAgICAgICAgICAgICBpZiAocGxheWVySWNvbikge1xuICAgICAgICAgICAgICAgICAgICBwbGF5ZXJJY29uLmluaXQoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdWlGdW5jLmNsb3NlVUkodGhpcy5ub2RlLm5hbWUpO1xuICAgICAgICAgICAgdGhpcy5ub2RlLmRlc3Ryb3koKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi56a75byA5oi/6Ze05aSx6LSlXCIpO1xuICAgICAgICB9XG4gICAgfSxcblxuXG4gICAgam9pbk92ZXJSZXNwb25zZTogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICBpZiAoZGF0YS5qb2luT3ZlclJzcC5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCLlhbPpl63miL/pl7TmiJDlip9cIik7XG4gICAgICAgICAgICB0aGlzLm5vdGlmeUdhbWVTdGFydCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCLlhbPpl63miL/pl7TlpLHotKXvvIzlm57osIPpgJrnn6XplJnor6/noIHvvJpcIiwgZGF0YS5qb2luT3ZlclJzcC5zdGF0dXMpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG5vdGlmeUdhbWVTdGFydDogZnVuY3Rpb24oKSB7XG4gICAgICAgIEdMQi5pc1Jvb21Pd25lciA9IHRydWU7XG4gICAgICAgIHZhciBldmVudCA9IHtcbiAgICAgICAgICAgIGFjdGlvbjogR0xCLkdBTUVfU1RBUlRfRVZFTlQsXG4gICAgICAgICAgICB1c2VySWRzOiBHTEIucGxheWVyVXNlcklkc1xuICAgICAgICB9O1xuICAgICAgICBtdnMuZW5naW5lLnNlbmRFdmVudChKU09OLnN0cmluZ2lmeShldmVudCkpO1xuICAgIH0sXG5cbiAgICBvbkRlc3Ryb3koKSB7XG4gICAgICAgIGNsaWVudEV2ZW50Lm9uKGNsaWVudEV2ZW50LmV2ZW50VHlwZS5qb2luUm9vbVJlc3BvbnNlLCB0aGlzLmpvaW5Sb29tUmVzcG9uc2UsIHRoaXMpO1xuICAgICAgICBjbGllbnRFdmVudC5vbihjbGllbnRFdmVudC5ldmVudFR5cGUuam9pblJvb21Ob3RpZnksIHRoaXMuam9pblJvb21Ob3RpZnksIHRoaXMpO1xuICAgICAgICBjbGllbnRFdmVudC5vbihjbGllbnRFdmVudC5ldmVudFR5cGUubGVhdmVSb29tUmVzcG9uc2UsIHRoaXMubGVhdmVSb29tUmVzcG9uc2UsIHRoaXMpO1xuICAgICAgICBjbGllbnRFdmVudC5vbihjbGllbnRFdmVudC5ldmVudFR5cGUubGVhdmVSb29tTm90aWZ5LCB0aGlzLmxlYXZlUm9vbU5vdGlmeSwgdGhpcyk7XG4gICAgICAgIGNsaWVudEV2ZW50Lm9uKGNsaWVudEV2ZW50LmV2ZW50VHlwZS5qb2luT3ZlclJlc3BvbnNlLCB0aGlzLmpvaW5PdmVyUmVzcG9uc2UsIHRoaXMpO1xuICAgIH1cbn0pO1xuIl19