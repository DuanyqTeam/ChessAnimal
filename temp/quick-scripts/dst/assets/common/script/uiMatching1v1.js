
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/common/script/uiMatching1v1.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '6d6c9MLzUhHZrbreB4tmBfP', 'uiMatching1v1');
// common/script/uiMatching1v1.js

"use strict";

var uiPanel = require("uiPanel");

var mvs = require("Matchvs");

var GLB = require("Glb");

cc.Class({
  "extends": uiPanel,
  properties: {
    playerIcons: [cc.Node]
  },
  onLoad: function onLoad() {
    this._super();

    this.nodeDict["quit"].on("click", this.leaveRoom, this);
    clientEvent.on(clientEvent.eventType.joinRoomResponse, this.joinRoomResponse, this);
    clientEvent.on(clientEvent.eventType.joinRoomNotify, this.joinRoomNotify, this);
    clientEvent.on(clientEvent.eventType.leaveRoomResponse, this.leaveRoomResponse, this);
    clientEvent.on(clientEvent.eventType.leaveRoomNotify, this.leaveRoomNotify, this);
    clientEvent.on(clientEvent.eventType.joinOverResponse, this.joinOverResponse, this);
  },
  joinRandomRoom: function joinRandomRoom() {
    var result = null;

    if (GLB.matchType === GLB.RANDOM_MATCH) {
      result = mvs.engine.joinRandomRoom(GLB.MAX_PLAYER_COUNT, '');

      if (result !== 0) {
        console.log('进入房间失败,错误码:' + result);
      }
    } else if (GLB.matchType === GLB.PROPERTY_MATCH) {
      var matchinfo = new mvs.MatchInfo();
      matchinfo.maxPlayer = GLB.MAX_PLAYER_COUNT;
      matchinfo.mode = 0;
      matchinfo.canWatch = 0;
      matchinfo.tags = GLB.tagsInfo;
      result = mvs.engine.joinRoomWithProperties(matchinfo, "joinRoomWithProperties");

      if (result !== 0) {
        console.log('进入房间失败,错误码:' + result);
      }
    }
  },
  startGame: function startGame() {
    console.log('游戏即将开始');
    cc.director.loadScene('game');
  },
  playIconInit: function playIconInit() {
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = this.playerIcons[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        var node = _step.value;
        node.active = false;
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator["return"] != null) {
          _iterator["return"]();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }
  },
  joinRoomResponse: function joinRoomResponse(data) {
    if (data.status !== 200) {
      console.log('进入房间失败,异步回调错误码: ' + data.status);
    } else {
      console.log('进入房间成功');
      console.log('房间号: ' + data.roomInfo.roomID);
    }

    GLB.roomId = data.roomInfo.roomID;
    var userIds = [GLB.userInfo.id];
    console.log('房间用户: ' + userIds);
    var playerIcon = null;

    for (var j = 0; j < data.roomUserInfoList.length; j++) {
      playerIcon = this.playerIcons[j].getComponent('playerIcon');

      if (playerIcon && !playerIcon.userInfo) {
        playerIcon.setData(data.roomUserInfoList[j]);

        if (GLB.userInfo.id !== data.roomUserInfoList[j].userId) {
          userIds.push(data.roomUserInfoList[j].userId);
        }
      }
    }

    for (var i = 0; i < this.playerIcons.length; i++) {
      playerIcon = this.playerIcons[i].getComponent('playerIcon');

      if (playerIcon && !playerIcon.userInfo) {
        playerIcon.setData(GLB.userInfo);
      }
    }

    GLB.playerUserIds = userIds;

    if (userIds.length >= GLB.MAX_PLAYER_COUNT) {
      var result = mvs.engine.joinOver("");
      console.log("发出关闭房间的通知");

      if (result !== 0) {
        console.log("关闭房间失败，错误码：", result);
      }

      GLB.playerUserIds = userIds;
    }
  },
  joinRoomNotify: function joinRoomNotify(data) {
    console.log("joinRoomNotify, roomUserInfo:" + JSON.stringify(data.roomUserInfo));
    var playerIcon = null;

    for (var j = 0; j < this.playerIcons.length; j++) {
      playerIcon = this.playerIcons[j].getComponent('playerIcon');

      if (playerIcon && !playerIcon.userInfo) {
        playerIcon.setData(data.roomUserInfo);
        break;
      }
    }
  },
  leaveRoom: function leaveRoom() {
    mvs.engine.leaveRoom("");
  },
  leaveRoomNotify: function leaveRoomNotify(data) {
    if (GLB.roomId === data.leaveRoomInfo.roomID) {
      for (var i = 0; i < this.playerIcons.length; i++) {
        var playerIcon = this.playerIcons[i].getComponent('playerIcon');

        if (playerIcon && playerIcon.userInfo && playerIcon.playerId === data.leaveRoomInfo.userId) {
          playerIcon.init();
          break;
        }
      }
    }
  },
  leaveRoomResponse: function leaveRoomResponse(data) {
    if (data.leaveRoomRsp.status === 200) {
      console.log("离开房间成功");

      for (var i = 0; i < this.playerIcons.length; i++) {
        var playerIcon = this.playerIcons[i].getComponent('playerIcon');

        if (playerIcon) {
          playerIcon.init();
          break;
        }
      }

      uiFunc.closeUI(this.node.name);
      this.node.destroy();
    } else {
      console.log("离开房间失败");
    }
  },
  joinOverResponse: function joinOverResponse(data) {
    if (data.joinOverRsp.status === 200) {
      console.log("关闭房间成功");
      this.notifyGameStart();
    } else {
      console.log("关闭房间失败，回调通知错误码：", data.joinOverRsp.status);
    }
  },
  notifyGameStart: function notifyGameStart() {
    GLB.isRoomOwner = true;
    var msg = {
      action: GLB.GAME_START_EVENT,
      userIds: GLB.playerUserIds
    };
    Game.GameManager.sendEventEx(msg);
  },
  onDestroy: function onDestroy() {
    clientEvent.off(clientEvent.eventType.joinRoomResponse, this.joinRoomResponse, this);
    clientEvent.off(clientEvent.eventType.joinRoomNotify, this.joinRoomNotify, this);
    clientEvent.off(clientEvent.eventType.leaveRoomResponse, this.leaveRoomResponse, this);
    clientEvent.off(clientEvent.eventType.leaveRoomNotify, this.leaveRoomNotify, this);
    clientEvent.off(clientEvent.eventType.joinOverResponse, this.joinOverResponse, this);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2Fzc2V0cy9jb21tb24vc2NyaXB0L2Fzc2V0cy9jb21tb24vc2NyaXB0L3VpTWF0Y2hpbmcxdjEuanMiXSwibmFtZXMiOlsidWlQYW5lbCIsInJlcXVpcmUiLCJtdnMiLCJHTEIiLCJjYyIsIkNsYXNzIiwicHJvcGVydGllcyIsInBsYXllckljb25zIiwiTm9kZSIsIm9uTG9hZCIsIl9zdXBlciIsIm5vZGVEaWN0Iiwib24iLCJsZWF2ZVJvb20iLCJjbGllbnRFdmVudCIsImV2ZW50VHlwZSIsImpvaW5Sb29tUmVzcG9uc2UiLCJqb2luUm9vbU5vdGlmeSIsImxlYXZlUm9vbVJlc3BvbnNlIiwibGVhdmVSb29tTm90aWZ5Iiwiam9pbk92ZXJSZXNwb25zZSIsImpvaW5SYW5kb21Sb29tIiwicmVzdWx0IiwibWF0Y2hUeXBlIiwiUkFORE9NX01BVENIIiwiZW5naW5lIiwiTUFYX1BMQVlFUl9DT1VOVCIsImNvbnNvbGUiLCJsb2ciLCJQUk9QRVJUWV9NQVRDSCIsIm1hdGNoaW5mbyIsIk1hdGNoSW5mbyIsIm1heFBsYXllciIsIm1vZGUiLCJjYW5XYXRjaCIsInRhZ3MiLCJ0YWdzSW5mbyIsImpvaW5Sb29tV2l0aFByb3BlcnRpZXMiLCJzdGFydEdhbWUiLCJkaXJlY3RvciIsImxvYWRTY2VuZSIsInBsYXlJY29uSW5pdCIsIm5vZGUiLCJhY3RpdmUiLCJkYXRhIiwic3RhdHVzIiwicm9vbUluZm8iLCJyb29tSUQiLCJyb29tSWQiLCJ1c2VySWRzIiwidXNlckluZm8iLCJpZCIsInBsYXllckljb24iLCJqIiwicm9vbVVzZXJJbmZvTGlzdCIsImxlbmd0aCIsImdldENvbXBvbmVudCIsInNldERhdGEiLCJ1c2VySWQiLCJwdXNoIiwiaSIsInBsYXllclVzZXJJZHMiLCJqb2luT3ZlciIsIkpTT04iLCJzdHJpbmdpZnkiLCJyb29tVXNlckluZm8iLCJsZWF2ZVJvb21JbmZvIiwicGxheWVySWQiLCJpbml0IiwibGVhdmVSb29tUnNwIiwidWlGdW5jIiwiY2xvc2VVSSIsIm5hbWUiLCJkZXN0cm95Iiwiam9pbk92ZXJSc3AiLCJub3RpZnlHYW1lU3RhcnQiLCJpc1Jvb21Pd25lciIsIm1zZyIsImFjdGlvbiIsIkdBTUVfU1RBUlRfRVZFTlQiLCJHYW1lIiwiR2FtZU1hbmFnZXIiLCJzZW5kRXZlbnRFeCIsIm9uRGVzdHJveSIsIm9mZiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFELENBQXJCOztBQUNBLElBQUlDLEdBQUcsR0FBR0QsT0FBTyxDQUFDLFNBQUQsQ0FBakI7O0FBQ0EsSUFBSUUsR0FBRyxHQUFHRixPQUFPLENBQUMsS0FBRCxDQUFqQjs7QUFDQUcsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxhQUFTTCxPQURKO0FBRUxNLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxXQUFXLEVBQUUsQ0FBQ0gsRUFBRSxDQUFDSSxJQUFKO0FBREwsR0FGUDtBQU1MQyxFQUFBQSxNQU5LLG9CQU1JO0FBQ0wsU0FBS0MsTUFBTDs7QUFDQSxTQUFLQyxRQUFMLENBQWMsTUFBZCxFQUFzQkMsRUFBdEIsQ0FBeUIsT0FBekIsRUFBa0MsS0FBS0MsU0FBdkMsRUFBa0QsSUFBbEQ7QUFDQUMsSUFBQUEsV0FBVyxDQUFDRixFQUFaLENBQWVFLFdBQVcsQ0FBQ0MsU0FBWixDQUFzQkMsZ0JBQXJDLEVBQXVELEtBQUtBLGdCQUE1RCxFQUE4RSxJQUE5RTtBQUNBRixJQUFBQSxXQUFXLENBQUNGLEVBQVosQ0FBZUUsV0FBVyxDQUFDQyxTQUFaLENBQXNCRSxjQUFyQyxFQUFxRCxLQUFLQSxjQUExRCxFQUEwRSxJQUExRTtBQUNBSCxJQUFBQSxXQUFXLENBQUNGLEVBQVosQ0FBZUUsV0FBVyxDQUFDQyxTQUFaLENBQXNCRyxpQkFBckMsRUFBd0QsS0FBS0EsaUJBQTdELEVBQWdGLElBQWhGO0FBQ0FKLElBQUFBLFdBQVcsQ0FBQ0YsRUFBWixDQUFlRSxXQUFX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Q0MsU0FBWixDQUFzQkksZUFBdEMsRUFBdUQsS0FBS0EsZUFBNUQsRUFBNkUsSUFBN0U7QUFDQUwsSUFBQUEsV0FBVyxDQUFDc0UsR0FBWixDQUFnQnRFLFdBQVcsQ0FBQ0MsU0FBWixDQUFzQkssZ0JBQXRDLEVBQXdELEtBQUtBLGdCQUE3RCxFQUErRSxJQUEvRTtBQUNIO0FBNUpJLENBQVQiLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4vLi4vYXNzZXRzL2NvbW1vbi9zY3JpcHQiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgdWlQYW5lbCA9IHJlcXVpcmUoXCJ1aVBhbmVsXCIpO1xudmFyIG12cyA9IHJlcXVpcmUoXCJNYXRjaHZzXCIpO1xudmFyIEdMQiA9IHJlcXVpcmUoXCJHbGJcIik7XG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogdWlQYW5lbCxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHBsYXllckljb25zOiBbY2MuTm9kZV1cbiAgICB9LFxuXG4gICAgb25Mb2FkKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLm5vZGVEaWN0W1wicXVpdFwiXS5vbihcImNsaWNrXCIsIHRoaXMubGVhdmVSb29tLCB0aGlzKTtcbiAgICAgICAgY2xpZW50RXZlbnQub24oY2xpZW50RXZlbnQuZXZlbnRUeXBlLmpvaW5Sb29tUmVzcG9uc2UsIHRoaXMuam9pblJvb21SZXNwb25zZSwgdGhpcyk7XG4gICAgICAgIGNsaWVudEV2ZW50Lm9uKGNsaWVudEV2ZW50LmV2ZW50VHlwZS5qb2luUm9vbU5vdGlmeSwgdGhpcy5qb2luUm9vbU5vdGlmeSwgdGhpcyk7XG4gICAgICAgIGNsaWVudEV2ZW50Lm9uKGNsaWVudEV2ZW50LmV2ZW50VHlwZS5sZWF2ZVJvb21SZXNwb25zZSwgdGhpcy5sZWF2ZVJvb21SZXNwb25zZSwgdGhpcyk7XG4gICAgICAgIGNsaWVudEV2ZW50Lm9uKGNsaWVudEV2ZW50LmV2ZW50VHlwZS5sZWF2ZVJvb21Ob3RpZnksIHRoaXMubGVhdmVSb29tTm90aWZ5LCB0aGlzKTtcbiAgICAgICAgY2xpZW50RXZlbnQub24oY2xpZW50RXZlbnQuZXZlbnRUeXBlLmpvaW5PdmVyUmVzcG9uc2UsIHRoaXMuam9pbk92ZXJSZXNwb25zZSwgdGhpcyk7XG4gICAgfSxcblxuICAgIGpvaW5SYW5kb21Sb29tOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IG51bGw7XG4gICAgICAgIGlmIChHTEIubWF0Y2hUeXBlID09PSBHTEIuUkFORE9NX01BVENIKSB7XG4gICAgICAgICAgICByZXN1bHQgPSBtdnMuZW5naW5lLmpvaW5SYW5kb21Sb29tKEdMQi5NQVhfUExBWUVSX0NPVU5ULCAnJyk7XG4gICAgICAgICAgICBpZiAocmVzdWx0ICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+i/m+WFpeaIv+mXtOWksei0pSzplJnor6/noIE6JyArIHJlc3VsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoR0xCLm1hdGNoVHlwZSA9PT0gR0xCLlBST1BFUlRZX01BVENIKSB7XG4gICAgICAgICAgICB2YXIgbWF0Y2hpbmZvID0gbmV3IG12cy5NYXRjaEluZm8oKTtcbiAgICAgICAgICAgIG1hdGNoaW5mby5tYXhQbGF5ZXIgPSBHTEIuTUFYX1BMQVlFUl9DT1VOVDtcbiAgICAgICAgICAgIG1hdGNoaW5mby5tb2RlID0gMDtcbiAgICAgICAgICAgIG1hdGNoaW5mby5jYW5XYXRjaCA9IDA7XG4gICAgICAgICAgICBtYXRjaGluZm8udGFncyA9IEdMQi50YWdzSW5mbztcbiAgICAgICAgICAgIHJlc3VsdCA9IG12cy5lbmdpbmUuam9pblJvb21XaXRoUHJvcGVydGllcyhtYXRjaGluZm8sIFwiam9pblJvb21XaXRoUHJvcGVydGllc1wiKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQgIT09IDApIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn6L+b5YWl5oi/6Ze05aSx6LSlLOmUmeivr+eggTonICsgcmVzdWx0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBzdGFydEdhbWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zb2xlLmxvZygn5ri45oiP5Y2z5bCG5byA5aeLJyk7XG4gICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZSgnZ2FtZScpO1xuICAgIH0sXG5cbiAgICBwbGF5SWNvbkluaXQgKCkge1xuICAgICAgICBmb3IoY29uc3Qgbm9kZSBvZiB0aGlzLnBsYXllckljb25zKSB7XG4gICAgICAgICAgICBub2RlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGpvaW5Sb29tUmVzcG9uc2U6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgaWYgKGRhdGEuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfov5vlhaXmiL/pl7TlpLHotKUs5byC5q2l5Zue6LCD6ZSZ6K+v56CBOiAnICsgZGF0YS5zdGF0dXMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ+i/m+WFpeaIv+mXtOaIkOWKnycpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ+aIv+mXtOWPtzogJyArIGRhdGEucm9vbUluZm8ucm9vbUlEKTtcbiAgICAgICAgfVxuICAgICAgICBHTEIucm9vbUlkID0gZGF0YS5yb29tSW5mby5yb29tSUQ7XG4gICAgICAgIHZhciB1c2VySWRzID0gW0dMQi51c2VySW5mby5pZF1cbiAgICAgICAgY29uc29sZS5sb2coJ+aIv+mXtOeUqOaItzogJyArIHVzZXJJZHMpO1xuXG4gICAgICAgIHZhciBwbGF5ZXJJY29uID0gbnVsbDtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBkYXRhLnJvb21Vc2VySW5mb0xpc3QubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIHBsYXllckljb24gPSB0aGlzLnBsYXllckljb25zW2pdLmdldENvbXBvbmVudCgncGxheWVySWNvbicpO1xuICAgICAgICAgICAgaWYgKHBsYXllckljb24gJiYgIXBsYXllckljb24udXNlckluZm8pIHtcbiAgICAgICAgICAgICAgICBwbGF5ZXJJY29uLnNldERhdGEoZGF0YS5yb29tVXNlckluZm9MaXN0W2pdKTtcbiAgICAgICAgICAgICAgICBpZiAoR0xCLnVzZXJJbmZvLmlkICE9PSBkYXRhLnJvb21Vc2VySW5mb0xpc3Rbal0udXNlcklkKSB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZHMucHVzaChkYXRhLnJvb21Vc2VySW5mb0xpc3Rbal0udXNlcklkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucGxheWVySWNvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHBsYXllckljb24gPSB0aGlzLnBsYXllckljb25zW2ldLmdldENvbXBvbmVudCgncGxheWVySWNvbicpO1xuICAgICAgICAgICAgaWYgKHBsYXllckljb24gJiYgIXBsYXllckljb24udXNlckluZm8pIHtcbiAgICAgICAgICAgICAgICBwbGF5ZXJJY29uLnNldERhdGEoR0xCLnVzZXJJbmZvKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBHTEIucGxheWVyVXNlcklkcyA9IHVzZXJJZHM7XG4gICAgICAgIGlmICh1c2VySWRzLmxlbmd0aCA+PSBHTEIuTUFYX1BMQVlFUl9DT1VOVCkge1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IG12cy5lbmdpbmUuam9pbk92ZXIoXCJcIik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIuWPkeWHuuWFs+mXreaIv+mXtOeahOmAmuefpVwiKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQgIT09IDApIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIuWFs+mXreaIv+mXtOWksei0pe+8jOmUmeivr+egge+8mlwiLCByZXN1bHQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBHTEIucGxheWVyVXNlcklkcyA9IHVzZXJJZHM7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgam9pblJvb21Ob3RpZnk6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJqb2luUm9vbU5vdGlmeSwgcm9vbVVzZXJJbmZvOlwiICsgSlNPTi5zdHJpbmdpZnkoZGF0YS5yb29tVXNlckluZm8pKTtcbiAgICAgICAgdmFyIHBsYXllckljb24gPSBudWxsO1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMucGxheWVySWNvbnMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIHBsYXllckljb24gPSB0aGlzLnBsYXllckljb25zW2pdLmdldENvbXBvbmVudCgncGxheWVySWNvbicpO1xuICAgICAgICAgICAgaWYgKHBsYXllckljb24gJiYgIXBsYXllckljb24udXNlckluZm8pIHtcbiAgICAgICAgICAgICAgICBwbGF5ZXJJY29uLnNldERhdGEoZGF0YS5yb29tVXNlckluZm8pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIGxlYXZlUm9vbTogZnVuY3Rpb24oKSB7XG4gICAgICAgIG12cy5lbmdpbmUubGVhdmVSb29tKFwiXCIpO1xuICAgIH0sXG5cbiAgICBsZWF2ZVJvb21Ob3RpZnk6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgaWYgKEdMQi5yb29tSWQgPT09IGRhdGEubGVhdmVSb29tSW5mby5yb29tSUQpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wbGF5ZXJJY29ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBwbGF5ZXJJY29uID0gdGhpcy5wbGF5ZXJJY29uc1tpXS5nZXRDb21wb25lbnQoJ3BsYXllckljb24nKTtcbiAgICAgICAgICAgICAgICBpZiAocGxheWVySWNvbiAmJiBwbGF5ZXJJY29uLnVzZXJJbmZvICYmIHBsYXllckljb24ucGxheWVySWQgPT09IGRhdGEubGVhdmVSb29tSW5mby51c2VySWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcGxheWVySWNvbi5pbml0KCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBsZWF2ZVJvb21SZXNwb25zZTogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICBpZiAoZGF0YS5sZWF2ZVJvb21Sc3Auc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi56a75byA5oi/6Ze05oiQ5YqfXCIpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBsYXllckljb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBsYXllckljb24gPSB0aGlzLnBsYXllckljb25zW2ldLmdldENvbXBvbmVudCgncGxheWVySWNvbicpO1xuICAgICAgICAgICAgICAgIGlmIChwbGF5ZXJJY29uKSB7XG4gICAgICAgICAgICAgICAgICAgIHBsYXllckljb24uaW5pdCgpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB1aUZ1bmMuY2xvc2VVSSh0aGlzLm5vZGUubmFtZSk7XG4gICAgICAgICAgICB0aGlzLm5vZGUuZGVzdHJveSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCLnprvlvIDmiL/pl7TlpLHotKVcIik7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgam9pbk92ZXJSZXNwb25zZTogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICBpZiAoZGF0YS5qb2luT3ZlclJzcC5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCLlhbPpl63miL/pl7TmiJDlip9cIik7XG4gICAgICAgICAgICB0aGlzLm5vdGlmeUdhbWVTdGFydCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCLlhbPpl63miL/pl7TlpLHotKXvvIzlm57osIPpgJrnn6XplJnor6/noIHvvJpcIiwgZGF0YS5qb2luT3ZlclJzcC5zdGF0dXMpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG5vdGlmeUdhbWVTdGFydDogZnVuY3Rpb24oKSB7XG4gICAgICAgIEdMQi5pc1Jvb21Pd25lciA9IHRydWU7XG4gICAgICAgIHZhciBtc2cgPSB7XG4gICAgICAgICAgICBhY3Rpb246IEdMQi5HQU1FX1NUQVJUX0VWRU5ULFxuICAgICAgICAgICAgdXNlcklkczogR0xCLnBsYXllclVzZXJJZHNcbiAgICAgICAgfTtcbiAgICAgICAgR2FtZS5HYW1lTWFuYWdlci5zZW5kRXZlbnRFeChtc2cpO1xuICAgIH0sXG5cbiAgICBvbkRlc3Ryb3koKSB7XG4gICAgICAgIGNsaWVudEV2ZW50Lm9mZihjbGllbnRFdmVudC5ldmVudFR5cGUuam9pblJvb21SZXNwb25zZSwgdGhpcy5qb2luUm9vbVJlc3BvbnNlLCB0aGlzKTtcbiAgICAgICAgY2xpZW50RXZlbnQub2ZmKGNsaWVudEV2ZW50LmV2ZW50VHlwZS5qb2luUm9vbU5vdGlmeSwgdGhpcy5qb2luUm9vbU5vdGlmeSwgdGhpcyk7XG4gICAgICAgIGNsaWVudEV2ZW50Lm9mZihjbGllbnRFdmVudC5ldmVudFR5cGUubGVhdmVSb29tUmVzcG9uc2UsIHRoaXMubGVhdmVSb29tUmVzcG9uc2UsIHRoaXMpO1xuICAgICAgICBjbGllbnRFdmVudC5vZmYoY2xpZW50RXZlbnQuZXZlbnRUeXBlLmxlYXZlUm9vbU5vdGlmeSwgdGhpcy5sZWF2ZVJvb21Ob3RpZnksIHRoaXMpO1xuICAgICAgICBjbGllbnRFdmVudC5vZmYoY2xpZW50RXZlbnQuZXZlbnRUeXBlLmpvaW5PdmVyUmVzcG9uc2UsIHRoaXMuam9pbk92ZXJSZXNwb25zZSwgdGhpcyk7XG4gICAgfVxufSk7XG4iXX0=