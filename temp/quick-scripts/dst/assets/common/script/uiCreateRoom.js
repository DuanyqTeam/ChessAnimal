
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/common/script/uiCreateRoom.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'e15a0SellRL6YcLfubCYSrA', 'uiCreateRoom');
// common/script/uiCreateRoom.js

"use strict";

var uiPanel = require("uiPanel");

var mvs = require("Matchvs");

var GLB = require("Glb");

cc.Class({
  "extends": uiPanel,
  properties: {},
  onLoad: function onLoad() {
    this._super();

    this.playerCntLb = this.nodeDict["playerCnt"].getComponent(cc.Label);
    this.playerCnt = GLB.PLAYER_COUNTS[0];
    this.playerCntLb.string = this.playerCnt;
    this.refreshBtnState();
    this.nodeDict["quit"].on("click", this.quit, this);
    this.nodeDict["addNode"].on("click", this.addPlayerCount, this);
    this.nodeDict["subNode"].on("click", this.subPlayerCount, this);
    this.nodeDict["create"].on("click", this.createRoom, this);
    clientEvent.on(clientEvent.eventType.createRoomResponse, this.createRoomResponse, this);
  },
  addPlayerCount: function addPlayerCount() {
    for (var i = 0; i < GLB.PLAYER_COUNTS.length; i++) {
      if (this.playerCnt === GLB.PLAYER_COUNTS[i]) {
        if (GLB.PLAYER_COUNTS.length > i + 1) {
          this.playerCnt = GLB.PLAYER_COUNTS[i + 1];
          break;
        }
      }
    }

    this.playerCntLb.string = this.playerCnt;
    this.refreshBtnState();
  },
  subPlayerCount: function subPlayerCount() {
    for (var i = 0; i < GLB.PLAYER_COUNTS.length; i++) {
      if (this.playerCnt === GLB.PLAYER_COUNTS[i]) {
        if (i > 0) {
          this.playerCnt = GLB.PLAYER_COUNTS[i - 1];
          break;
        }
      }
    }

    this.playerCntLb.string = this.playerCnt;
    this.refreshBtnState();
  },
  refreshBtnState: function refreshBtnState() {
    if (this.playerCnt === GLB.PLAYER_COUNTS[0]) {
      this.nodeDict["subNode"].getComponent(cc.Button).interactable = false;
    } else {
      this.nodeDict["subNode"].getComponent(cc.Button).interactable = true;
    }

    if (this.playerCnt === GLB.PLAYER_COUNTS[GLB.PLAYER_COUNTS.length - 1]) {
      this.nodeDict["addNode"].getComponent(cc.Button).interactable = false;
    } else {
      this.nodeDict["addNode"].getComponent(cc.Button).interactable = true;
    }
  },
  quit: function quit() {
    uiFunc.closeUI(this.node.name);
    this.node.destroy();
  },
  createRoom: function createRoom() {
    Game.GameManager.blockInput();
    var create = new mvs.CreateRoomInfo();
    create.roomName = this.nodeDict["roomName"].getComponent(cc.EditBox).string;
    GLB.MAX_PLAYER_COUNT = this.playerCnt;
    create.maxPlayer = GLB.MAX_PLAYER_COUNT;
    create.mode = 0;
    create.canWatch = 0;
    create.visibility = 1;
    create.roomProperty = GLB.MAX_PLAYER_COUNT;
    var result = mvs.engine.createRoom(create, {
      maxPlayer: GLB.MAX_PLAYER_COUNT
    });

    if (result !== 0) {
      console.log('创建房间失败,错误码:' + result);
    }
  },
  createRoomResponse: function createRoomResponse(data) {
    var status = data.rsp.status;

    if (status !== 200) {
      console.log('创建房间失败,异步回调错误码: ' + status);
    } else {
      console.log('创建房间成功:' + JSON.stringify(data.rsp));
      console.log('房间号: ' + data.rsp.roomID);
      GLB.roomId = data.rsp.roomID;

      if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {
        uiFunc.openUI("uiRoomVer", function (obj) {
          var room = obj.getComponent('uiRoom');
          room.createRoomInit(data.rsp);
          uiFunc.closeUI(this.node.name);
          this.node.destroy();
        }.bind(this));
      } else {
        uiFunc.openUI("uiRoom", function (obj) {
          var room = obj.getComponent('uiRoom');
          room.createRoomInit(data.rsp);
          uiFunc.closeUI(this.node.name);
          this.node.destroy();
        }.bind(this));
      }
    }
  },
  onDestroy: function onDestroy() {
    if (window.wx) {
      wx.offKeyboardComplete();
      wx.offKeyboardInput();
      wx.hideKeyboard();
    }

    clientEvent.off(clientEvent.eventType.createRoomResponse, this.createRoomResponse, this);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2Fzc2V0cy9jb21tb24vc2NyaXB0L2Fzc2V0cy9jb21tb24vc2NyaXB0L3VpQ3JlYXRlUm9vbS5qcyJdLCJuYW1lcyI6WyJ1aVBhbmVsIiwicmVxdWlyZSIsIm12cyIsIkdMQiIsImNjIiwiQ2xhc3MiLCJwcm9wZXJ0aWVzIiwib25Mb2FkIiwiX3N1cGVyIiwicGxheWVyQ250TGIiLCJub2RlRGljdCIsImdldENvbXBvbmVudCIsIkxhYmVsIiwicGxheWVyQ250IiwiUExBWUVSX0NPVU5UUyIsInN0cmluZyIsInJlZnJlc2hCdG5TdGF0ZSIsIm9uIiwicXVpdCIsImFkZFBsYXllckNvdW50Iiwic3ViUGxheWVyQ291bnQiLCJjcmVhdGVSb29tIiwiY2xpZW50RXZlbnQiLCJldmVudFR5cGUiLCJjcmVhdGVSb29tUmVzcG9uc2UiLCJpIiwibGVuZ3RoIiwiQnV0dG9uIiwiaW50ZXJhY3RhYmxlIiwidWlGdW5jIiwiY2xvc2VVSSIsIm5vZGUiLCJuYW1lIiwiZGVzdHJveSIsIkdhbWUiLCJHYW1lTWFuYWdlciIsImJsb2NrSW5wdXQiLCJjcmVhdGUiLCJDcmVhdGVSb29tSW5mbyIsInJvb21OYW1lIiwiRWRpdEJveCIsIk1BWF9QTEFZRVJfQ09VTlQiLCJtYXhQbGF5ZXIiLCJtb2RlIiwiY2FuV2F0Y2giLCJ2aXNpYmlsaXR5Iiwicm9vbVByb3BlcnR5IiwicmVzdWx0IiwiZW5naW5lIiwiY29uc29sZSIsImxvZyIsImRhdGEiLCJzdGF0dXMiLCJyc3AiLCJKU09OIiwic3RyaW5naWZ5Iiwicm9vbUlEIiwicm9vbUlkIiwiQ2FudmFzIiwiaW5zdGFuY2UiLCJkZXNpZ25SZXNvbHV0aW9uIiwiaGVpZ2h0Iiwid2lkdGgiLCJvcGVuVUkiLCJvYmoiLCJyb29tIiwiY3JlYXRlUm9vbUluaXQiLCJiaW5kIiwib25EZXN0cm95Iiwid2luZG93Iiwid3giLCJvZmZLZXlib2FyZENvbXBsZXRlIiwib2ZmS2V5Ym9hcmRJbnB1dCIs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Q0FELE1BQUFBLEVBQUUsQ0FBQ0UsZ0JBQUg7QUFDQUYsTUFBQUEsRUFBRSxDQUFDRyxZQUFIO0FBQ0g7O0FBQ0RuRCxJQUFBQSxXQUFXLENBQUNvRCxHQUFaLENBQWdCcEQsV0FBVyxDQUFDQyxTQUFaLENBQXNCQyxrQkFBdEMsRUFBMEQsS0FBS0Esa0JBQS9ELEVBQW1GLElBQW5GO0FBQ0g7QUFuSEksQ0FBVCIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLi8uLi8uLi9hc3NldHMvY29tbW9uL3NjcmlwdCIsInNvdXJjZXNDb250ZW50IjpbInZhciB1aVBhbmVsID0gcmVxdWlyZShcInVpUGFuZWxcIik7XG52YXIgbXZzID0gcmVxdWlyZShcIk1hdGNodnNcIik7XG52YXIgR0xCID0gcmVxdWlyZShcIkdsYlwiKTtcbmNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiB1aVBhbmVsLFxuICAgIHByb3BlcnRpZXM6IHt9LFxuXG4gICAgb25Mb2FkKCkge1xuICAgICAgICB0aGlzLl9zdXBlcigpO1xuICAgICAgICB0aGlzLnBsYXllckNudExiID0gdGhpcy5ub2RlRGljdFtcInBsYXllckNudFwiXS5nZXRDb21wb25lbnQoY2MuTGFiZWwpO1xuICAgICAgICB0aGlzLnBsYXllckNudCA9IEdMQi5QTEFZRVJfQ09VTlRTWzBdO1xuICAgICAgICB0aGlzLnBsYXllckNudExiLnN0cmluZyA9IHRoaXMucGxheWVyQ250O1xuICAgICAgICB0aGlzLnJlZnJlc2hCdG5TdGF0ZSgpO1xuICAgICAgICB0aGlzLm5vZGVEaWN0W1wicXVpdFwiXS5vbihcImNsaWNrXCIsIHRoaXMucXVpdCwgdGhpcyk7XG4gICAgICAgIHRoaXMubm9kZURpY3RbXCJhZGROb2RlXCJdLm9uKFwiY2xpY2tcIiwgdGhpcy5hZGRQbGF5ZXJDb3VudCwgdGhpcyk7XG4gICAgICAgIHRoaXMubm9kZURpY3RbXCJzdWJOb2RlXCJdLm9uKFwiY2xpY2tcIiwgdGhpcy5zdWJQbGF5ZXJDb3VudCwgdGhpcyk7XG4gICAgICAgIHRoaXMubm9kZURpY3RbXCJjcmVhdGVcIl0ub24oXCJjbGlja1wiLCB0aGlzLmNyZWF0ZVJvb20sIHRoaXMpO1xuXG4gICAgICAgIGNsaWVudEV2ZW50Lm9uKGNsaWVudEV2ZW50LmV2ZW50VHlwZS5jcmVhdGVSb29tUmVzcG9uc2UsIHRoaXMuY3JlYXRlUm9vbVJlc3BvbnNlLCB0aGlzKTtcbiAgICB9LFxuXG4gICAgYWRkUGxheWVyQ291bnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IEdMQi5QTEFZRVJfQ09VTlRTLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wbGF5ZXJDbnQgPT09IEdMQi5QTEFZRVJfQ09VTlRTW2ldKSB7XG4gICAgICAgICAgICAgICAgaWYgKEdMQi5QTEFZRVJfQ09VTlRTLmxlbmd0aCA+IGkgKyAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucGxheWVyQ250ID0gR0xCLlBMQVlFUl9DT1VOVFNbaSArIDFdO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnBsYXllckNudExiLnN0cmluZyA9IHRoaXMucGxheWVyQ250O1xuICAgICAgICB0aGlzLnJlZnJlc2hCdG5TdGF0ZSgpO1xuICAgIH0sXG5cbiAgICBzdWJQbGF5ZXJDb3VudDogZnVuY3Rpb24oKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgR0xCLlBMQVlFUl9DT1VOVFMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnBsYXllckNudCA9PT0gR0xCLlBMQVlFUl9DT1VOVFNbaV0pIHtcbiAgICAgICAgICAgICAgICBpZiAoaSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJDbnQgPSBHTEIuUExBWUVSX0NPVU5UU1tpIC0gMV07XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBsYXllckNudExiLnN0cmluZyA9IHRoaXMucGxheWVyQ250O1xuICAgICAgICB0aGlzLnJlZnJlc2hCdG5TdGF0ZSgpO1xuICAgIH0sXG5cbiAgICByZWZyZXNoQnRuU3RhdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLnBsYXllckNudCA9PT0gR0xCLlBMQVlFUl9DT1VOVFNbMF0pIHtcbiAgICAgICAgICAgIHRoaXMubm9kZURpY3RbXCJzdWJOb2RlXCJdLmdldENvbXBvbmVudChjYy5CdXR0b24pLmludGVyYWN0YWJsZSA9IGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5ub2RlRGljdFtcInN1Yk5vZGVcIl0uZ2V0Q29tcG9uZW50KGNjLkJ1dHRvbikuaW50ZXJhY3RhYmxlID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnBsYXllckNudCA9PT0gR0xCLlBMQVlFUl9DT1VOVFNbR0xCLlBMQVlFUl9DT1VOVFMubGVuZ3RoIC0gMV0pIHtcbiAgICAgICAgICAgIHRoaXMubm9kZURpY3RbXCJhZGROb2RlXCJdLmdldENvbXBvbmVudChjYy5CdXR0b24pLmludGVyYWN0YWJsZSA9IGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5ub2RlRGljdFtcImFkZE5vZGVcIl0uZ2V0Q29tcG9uZW50KGNjLkJ1dHRvbikuaW50ZXJhY3RhYmxlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBxdWl0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdWlGdW5jLmNsb3NlVUkodGhpcy5ub2RlLm5hbWUpO1xuICAgICAgICB0aGlzLm5vZGUuZGVzdHJveSgpO1xuICAgIH0sXG5cbiAgICBjcmVhdGVSb29tOiBmdW5jdGlvbigpIHtcbiAgICAgICAgR2FtZS5HYW1lTWFuYWdlci5ibG9ja0lucHV0KCk7XG5cbiAgICAgICAgdmFyIGNyZWF0ZSA9IG5ldyBtdnMuQ3JlYXRlUm9vbUluZm8oKTtcbiAgICAgICAgY3JlYXRlLnJvb21OYW1lID0gdGhpcy5ub2RlRGljdFtcInJvb21OYW1lXCJdLmdldENvbXBvbmVudChjYy5FZGl0Qm94KS5zdHJpbmc7XG4gICAgICAgIEdMQi5NQVhfUExBWUVSX0NPVU5UID0gdGhpcy5wbGF5ZXJDbnQ7XG4gICAgICAgIGNyZWF0ZS5tYXhQbGF5ZXIgPSBHTEIuTUFYX1BMQVlFUl9DT1VOVDtcbiAgICAgICAgY3JlYXRlLm1vZGUgPSAwO1xuICAgICAgICBjcmVhdGUuY2FuV2F0Y2ggPSAwO1xuICAgICAgICBjcmVhdGUudmlzaWJpbGl0eSA9IDE7XG4gICAgICAgIGNyZWF0ZS5yb29tUHJvcGVydHkgPSBHTEIuTUFYX1BMQVlFUl9DT1VOVDtcbiAgICAgICAgdmFyIHJlc3VsdCA9IG12cy5lbmdpbmUuY3JlYXRlUm9vbShjcmVhdGUsIHsgbWF4UGxheWVyOiBHTEIuTUFYX1BMQVlFUl9DT1VOVCB9KTtcbiAgICAgICAgaWYgKHJlc3VsdCAhPT0gMCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ+WIm+W7uuaIv+mXtOWksei0pSzplJnor6/noIE6JyArIHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY3JlYXRlUm9vbVJlc3BvbnNlOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgIHZhciBzdGF0dXMgPSBkYXRhLnJzcC5zdGF0dXM7XG4gICAgICAgIGlmIChzdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ+WIm+W7uuaIv+mXtOWksei0pSzlvILmraXlm57osIPplJnor6/noIE6ICcgKyBzdGF0dXMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ+WIm+W7uuaIv+mXtOaIkOWKnzonICsgSlNPTi5zdHJpbmdpZnkoZGF0YS5yc3ApKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfmiL/pl7Tlj7c6ICcgKyBkYXRhLnJzcC5yb29tSUQpO1xuICAgICAgICAgICAgR0xCLnJvb21JZCA9IGRhdGEucnNwLnJvb21JRDtcblxuICAgICAgICAgICAgaWYgKGNjLkNhbnZhcy5pbnN0YW5jZS5kZXNpZ25SZXNvbHV0aW9uLmhlaWdodCA+IGNjLkNhbnZhcy5pbnN0YW5jZS5kZXNpZ25SZXNvbHV0aW9uLndpZHRoKSB7XG4gICAgICAgICAgICAgICAgdWlGdW5jLm9wZW5VSShcInVpUm9vbVZlclwiLCBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvb20gPSBvYmouZ2V0Q29tcG9uZW50KCd1aVJvb20nKTtcbiAgICAgICAgICAgICAgICAgICAgcm9vbS5jcmVhdGVSb29tSW5pdChkYXRhLnJzcCk7XG4gICAgICAgICAgICAgICAgICAgIHVpRnVuYy5jbG9zZVVJKHRoaXMubm9kZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub2RlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB1aUZ1bmMub3BlblVJKFwidWlSb29tXCIsIGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcm9vbSA9IG9iai5nZXRDb21wb25lbnQoJ3VpUm9vbScpO1xuICAgICAgICAgICAgICAgICAgICByb29tLmNyZWF0ZVJvb21Jbml0KGRhdGEucnNwKTtcbiAgICAgICAgICAgICAgICAgICAgdWlGdW5jLmNsb3NlVUkodGhpcy5ub2RlLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm5vZGUuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25EZXN0cm95OiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHdpbmRvdy53eCkge1xuICAgICAgICAgICAgd3gub2ZmS2V5Ym9hcmRDb21wbGV0ZSgpO1xuICAgICAgICAgICAgd3gub2ZmS2V5Ym9hcmRJbnB1dCgpO1xuICAgICAgICAgICAgd3guaGlkZUtleWJvYXJkKCk7XG4gICAgICAgIH1cbiAgICAgICAgY2xpZW50RXZlbnQub2ZmKGNsaWVudEV2ZW50LmV2ZW50VHlwZS5jcmVhdGVSb29tUmVzcG9uc2UsIHRoaXMuY3JlYXRlUm9vbVJlc3BvbnNlLCB0aGlzKTtcbiAgICB9XG59KTtcbiJdfQ==