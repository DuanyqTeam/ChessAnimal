{"version":3,"sources":["../../../../../assets/common/script/assets/common/script/uiCreateRoom.js"],"names":["uiPanel","require","mvs","GLB","cc","Class","properties","onLoad","_super","playerCntLb","nodeDict","getComponent","Label","playerCnt","PLAYER_COUNTS","string","refreshBtnState","on","quit","addPlayerCount","subPlayerCount","createRoom","clientEvent","eventType","createRoomResponse","i","length","Button","interactable","uiFunc","closeUI","node","name","destroy","Game","GameManager","blockInput","create","CreateRoomInfo","roomName","EditBox","MAX_PLAYER_COUNT","maxPlayer","mode","canWatch","visibility","roomProperty","result","engine","console","log","data","status","rsp","JSON","stringify","roomID","roomId","Canvas","instance","designResolution","height","width","openUI","obj","room","createRoomInit","bind","onDestroy","window","wx","offKeyboardComplete","offKeyboardInput","hideKeyboard","off"],"mappings":"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","sourceRoot":"../../../../../assets/common/script","sourcesContent":["var uiPanel = require(\"uiPanel\");\nvar mvs = require(\"Matchvs\");\nvar GLB = require(\"Glb\");\ncc.Class({\n    extends: uiPanel,\n    properties: {},\n\n    onLoad() {\n        this._super();\n        this.playerCntLb = this.nodeDict[\"playerCnt\"].getComponent(cc.Label);\n        this.playerCnt = GLB.PLAYER_COUNTS[0];\n        this.playerCntLb.string = this.playerCnt;\n        this.refreshBtnState();\n        this.nodeDict[\"quit\"].on(\"click\", this.quit, this);\n        this.nodeDict[\"addNode\"].on(\"click\", this.addPlayerCount, this);\n        this.nodeDict[\"subNode\"].on(\"click\", this.subPlayerCount, this);\n        this.nodeDict[\"create\"].on(\"click\", this.createRoom, this);\n\n        clientEvent.on(clientEvent.eventType.createRoomResponse, this.createRoomResponse, this);\n    },\n\n    addPlayerCount: function() {\n        for (var i = 0; i < GLB.PLAYER_COUNTS.length; i++) {\n            if (this.playerCnt === GLB.PLAYER_COUNTS[i]) {\n                if (GLB.PLAYER_COUNTS.length > i + 1) {\n                    this.playerCnt = GLB.PLAYER_COUNTS[i + 1];\n                    break;\n                }\n            }\n        }\n\n        this.playerCntLb.string = this.playerCnt;\n        this.refreshBtnState();\n    },\n\n    subPlayerCount: function() {\n        for (var i = 0; i < GLB.PLAYER_COUNTS.length; i++) {\n            if (this.playerCnt === GLB.PLAYER_COUNTS[i]) {\n                if (i > 0) {\n                    this.playerCnt = GLB.PLAYER_COUNTS[i - 1];\n                    break;\n                }\n            }\n        }\n        this.playerCntLb.string = this.playerCnt;\n        this.refreshBtnState();\n    },\n\n    refreshBtnState() {\n        if (this.playerCnt === GLB.PLAYER_COUNTS[0]) {\n            this.nodeDict[\"subNode\"].getComponent(cc.Button).interactable = false;\n        } else {\n            this.nodeDict[\"subNode\"].getComponent(cc.Button).interactable = true;\n        }\n\n        if (this.playerCnt === GLB.PLAYER_COUNTS[GLB.PLAYER_COUNTS.length - 1]) {\n            this.nodeDict[\"addNode\"].getComponent(cc.Button).interactable = false;\n        } else {\n            this.nodeDict[\"addNode\"].getComponent(cc.Button).interactable = true;\n        }\n    },\n\n    quit: function() {\n        uiFunc.closeUI(this.node.name);\n        this.node.destroy();\n    },\n\n    createRoom: function() {\n        Game.GameManager.blockInput();\n\n        var create = new mvs.CreateRoomInfo();\n        create.roomName = this.nodeDict[\"roomName\"].getComponent(cc.EditBox).string;\n        GLB.MAX_PLAYER_COUNT = this.playerCnt;\n        create.maxPlayer = GLB.MAX_PLAYER_COUNT;\n        create.mode = 0;\n        create.canWatch = 0;\n        create.visibility = 1;\n        create.roomProperty = GLB.MAX_PLAYER_COUNT;\n        var result = mvs.engine.createRoom(create, { maxPlayer: GLB.MAX_PLAYER_COUNT });\n        if (result !== 0) {\n            console.log('创建房间失败,错误码:' + result);\n        }\n    },\n\n    createRoomResponse: function(data) {\n        var status = data.rsp.status;\n        if (status !== 200) {\n            console.log('创建房间失败,异步回调错误码: ' + status);\n        } else {\n            console.log('创建房间成功:' + JSON.stringify(data.rsp));\n            console.log('房间号: ' + data.rsp.roomID);\n            GLB.roomId = data.rsp.roomID;\n\n            if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\n                uiFunc.openUI(\"uiRoomVer\", function(obj) {\n                    var room = obj.getComponent('uiRoom');\n                    room.createRoomInit(data.rsp);\n                    uiFunc.closeUI(this.node.name);\n                    this.node.destroy();\n                }.bind(this));\n            } else {\n                uiFunc.openUI(\"uiRoom\", function(obj) {\n                    var room = obj.getComponent('uiRoom');\n                    room.createRoomInit(data.rsp);\n                    uiFunc.closeUI(this.node.name);\n                    this.node.destroy();\n                }.bind(this));\n            }\n        }\n    },\n\n    onDestroy: function() {\n        if (window.wx) {\n            wx.offKeyboardComplete();\n            wx.offKeyboardInput();\n            wx.hideKeyboard();\n        }\n        clientEvent.off(clientEvent.eventType.createRoomResponse, this.createRoomResponse, this);\n    }\n});\n"]}