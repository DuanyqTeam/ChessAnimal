{"version":3,"sources":["../../../../../assets/common/script/assets/common/script/chess.js"],"names":["GLB","require","cc","Class","Component","properties","bgColor","SpriteFrame","blueChessPiecesArr","redChessPiecesArr","onLoad","chessNode","node","getChildByName","yanwuNode","backImgNode","leftNode","rightNode","upNode","downNode","clientEvent","on","eventType","openChessPiece","openChessPieceEvent","active","isOpen","isMoving","setChessType","type","index","chessPieceNode","PLAYER_FLAG","BLUE","setScale","getComponent","Sprite","spriteFrame","RED","tag","sign","user","setAudio","stepIfEatOrOpen","Animation","play","bind","setTimeout","dispatch","setPosition","x","y","apply","arguments","getPosition","getNode","getIndex","getAnimateStep","pickUp","isPlaying","putDown","clearDirection","zIndex","setMoveDirection","data","cb","left","largeThanleft","color","right","largeThanright","up","largeThanup","down","largeThandown","animatPutDown","parm","scale","once","setDestory","start","onDestroy","off"],"mappings":"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","sourceRoot":"../../../../../assets/common/script","sourcesContent":["var GLB = require(\"Glb\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        bgColor: [cc.SpriteFrame],\n        blueChessPiecesArr: [cc.SpriteFrame],\n        redChessPiecesArr: [cc.SpriteFrame]\n    },\n\n    onLoad () {\n        this.chessNode = this.node.getChildByName('chessNode');\n        this.yanwuNode = this.node.getChildByName('yanwu');\n        this.backImgNode = this.node.getChildByName('backImg');\n        this.leftNode = this.node.getChildByName('left');\n        this.rightNode = this.node.getChildByName('right');\n        this.upNode = this.node.getChildByName('up');\n        this.downNode = this.node.getChildByName('down');\n        // clientEvent.on(clientEvent.eventType.openChessPiece, function (tag) {\n        //     if (this.node.tag !== tag) return;\n        //     this.openChessPiece();\n        // }.bind(this))\n        clientEvent.on(clientEvent.eventType.openChessPiece, this.openChessPieceEvent, this);\n        this.leftNode.active = false;\n        this.rightNode.active = false;\n        this.upNode.active = false;\n        this.downNode.active = false;\n        this.yanwuNode.active = false;\n        this.isOpen = false;\n        this.isMoving = false;\n    },\n\n    setChessType:function (type,index) {\n       this.chessPieceNode = this.node.getChildByName('chessNode').getChildByName('chessPiece');\n        // if (index % 10 === 8) {\n        //     this.chessPieceNode.x += 10;\n        //     this.chessPieceNode.y += 20;\n        // } else if (index % 10 === 7) {\n        //     this.chessPieceNode.x -= 5;\n        //     this.chessPieceNode.y += 20;\n        // } else if (index % 10 === 6) {\n        //     this.chessPieceNode.y += 12;\n        // } else if (index % 10 === 5) {\n        //     this.chessPieceNode.y += 15;\n        // }\n        if(type === GLB.PLAYER_FLAG.BLUE)\n        {\n            this.chessPieceNode.setScale(1);\n            this.chessPieceNode.getComponent(cc.Sprite).spriteFrame = this.blueChessPiecesArr[index-1];\n\n        }\n        else if(type === GLB.PLAYER_FLAG.RED){\n            this.chessPieceNode.setScale(1);\n            this.chessPieceNode.getComponent(cc.Sprite).spriteFrame = this.redChessPiecesArr[index-10-1];\n        }\n\n        this.type = type;\n        this.index = index - 1;\n    },\n\n    openChessPieceEvent (tag) {\n        if (this.node.sign !== tag) return;\n        this.openChessPiece();\n    },\n\n    openChessPiece:function () {\n        //  播放音乐\n        user.setAudio(this.index % 10);\n        user.stepIfEatOrOpen(2);\n        this.backImgNode.getComponent(cc.Animation).play(\"openAnm\").on(\"finished\",function() {\n            this.backImgNode.active = false;\n            this.chessNode.active = true;\n            this.yanwuNode.active = true;\n            this.yanwuNode.getComponent(cc.Animation).play(\"yanwu\");\n        }.bind(this));\n\n        // TODO 第一次翻棋\n        // if (user.fristFilpChess === 1) {//第一次翻棋\n        //     if (this.index <= 10) {\n        //         user.isBlue = true;\n        //     } else {\n        //         user.isBlue = false;\n        //     }\n        //     user.fristFilpChess = 0;\n        //     clientEvent.dispatchEvent(\"changeColor\", user.isBlue);\n        //     user.sendGameData(user.gameDataProto.firstFlipChess, {isBlue:user.isBlue});\n        // }\n\n        setTimeout(function() {\n            clientEvent.dispatch(\"isGameOver\");\n        }.bind(this), 1000);\n    },\n\n    setPosition: function(x, y) {\n        this.node.setPosition.apply(this.node, arguments);\n    },\n\n    getPosition () {\n        return this.node.getPosition();\n    },\n\n    getNode:function(){\n        return this.node;\n    },\n\n    getIndex:function() {\n        return this.index + 1;\n    },\n\n    getAnimateStep:function() {\n        if (this.pickUp) {\n            if (this.pickUp.isPlaying === true) {\n                return true\n            }\n        }\n        if (this.putDown) {\n            if (this.putDown.isPlaying === true) {\n                return true\n            }\n        }\n        return false;\n    },\n\n    clearDirection:function() {\n        // this.leftNode = this.node.getChildByName('left');\n        // this.rightNode = this.node.getChildByName('right');\n        // this.upNode = this.node.getChildByName('up');\n        // this.downNode = this.node.getChildByName('down');\n        this.node.zIndex = 0;\n        this.leftNode.active = false;\n        this.rightNode.active = false;\n        this.upNode.active = false;\n        this.downNode.active = false;\n\n    },\n\n    setMoveDirection:function (data, cb) {\n        this.pickUp = this.chessNode.getComponent(cc.Animation).play(\"pickUp\");\n        // this.leftNode = this.node.getChildByName('left');\n        // this.rightNode = this.node.getChildByName('right');\n        // this.upNode = this.node.getChildByName('up');\n        // this.downNode = this.node.getChildByName('down');\n        this.node.zIndex = 100;\n        if(data.left)\n        {\n            this.leftNode.active = data.left;\n            if(data.largeThanleft)\n            {\n                this.leftNode.color = new cc.color(\"#FFFFFF\");\n                // this.widget[\"left\"].getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(cc.url.raw(canDownUrl));\n            }\n            else{\n                this.leftNode.color = new cc.color(\"#FF4E4E\");\n                // this.widget[\"left\"].getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(cc.url.raw(notDownUrl));\n            }\n        }\n        if(data.right)\n        {\n            this.rightNode.active = data.right;\n            if(data.largeThanright)\n            {\n                this.rightNode.color = new cc.color(\"#FFFFFF\");\n                // this.widget[\"right\"].getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(cc.url.raw(canDownUrl));\n            }\n            else{\n                this.rightNode.color = new cc.color(\"#FF4E4E\");\n                // this.widget[\"right\"].getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(cc.url.raw(notDownUrl));\n            }\n        }\n        if(data.up)\n        {\n            this.upNode.active = data.up;\n            if(data.largeThanup)\n            {\n                this.upNode.color = new cc.color(\"#FFFFFF\");\n                // this.widget[\"up\"].getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(cc.url.raw(canDownUrl));\n            }\n            else{\n                this.upNode.color = new cc.color(\"#FF4E4E\");\n                // this.widget[\"up\"].getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(cc.url.raw(notDownUrl));\n            }\n        }\n        if(data.down)\n        {\n            this.downNode.active = data.down;\n            if(data.largeThandown)\n            {\n                this.downNode.color = new cc.color(\"#FFFFFF\");\n                // this.widget[\"down\"].getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(cc.url.raw(canDownUrl));\n            }\n            else{\n                this.downNode.color = new cc.color(\"#FF4E4E\");\n                // this.widget[\"down\"].getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(cc.url.raw(notDownUrl));\n            }\n        }\n        if (cb) {\n            cb();\n        }\n    },\n\n    animatPutDown:function(cb,parm) {\n        if (this.chessNode.scale === 1.2) {\n            this.putDown  = this.chessNode.getComponent(cc.Animation).play(\"putDown\").once(\"finished\",function() {\n                if (parm) {\n                    cb();\n                    return;\n                }\n                if (!cb) {\n                    return;\n                }\n                this.yanwuNode.active = true;\n                this.yanwuNode.getComponent(cc.Animation).play(\"yanwu\").once(\"finished\",function() {\n                    this.yanwuNode.active = false;\n                    if (cb) {\n                        cb();\n                    }\n                }.bind(this));\n            }.bind(this));\n        } else {\n\n            if (cb) {\n                cb();\n            }\n\n        }\n    },\n\n    setDestory:function(){\n        this.node.active = false;\n    },\n\n    start () {\n\n    },\n\n    onDestroy () {\n        clientEvent.off(clientEvent.eventType.openChessPiece, this.openChessPieceEvent, this);\n    }\n\n    // update (dt) {},\n});\n"]}