{"version":3,"sources":["../../../../../assets/common/script/assets/common/script/uiRoomList.js"],"names":["uiPanel","require","mvs","GLB","cc","Class","properties","start","roomPrefab","nodeDict","editBox","getComponent","EditBox","active","on","search","quit","rooms","clientEvent","eventType","getRoomListResponse","joinRoomResponse","getRoomListExResponse","getRoomList","roomRqId","setInterval","string","bind","filter","maxPlayer","mode","canWatch","roomProperty","full","state","sort","order","pageNo","pageSize","engine","getRoomListEx","data","j","length","destroy","roomInfos","a","b","roomID","i","room","instantiate","parent","roomScript","setData","push","roomAttrs","rsp","clearInterval","uiFunc","closeUI","node","name","roomIdLb","status","console","log","roomInfo","roomUserInfoList","some","x","userId","userInfo","id","userProfile","MAX_PLAYER_COUNT","Canvas","instance","designResolution","height","width","openUI","obj","joinRoomInit","onDestroy","window","wx","offKeyboardComplete","offKeyboardInput","hideKeyboard","off"],"mappings":"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","sourceRoot":"../../../../../assets/common/script","sourcesContent":["var uiPanel = require(\"uiPanel\");\nvar mvs = require(\"Matchvs\");\nvar GLB = require(\"Glb\");\ncc.Class({\n    extends: uiPanel,\n\n    properties: {},\n\n    start() {\n        this.roomPrefab = this.nodeDict[\"roomPrefab\"];\n        this.editBox = this.nodeDict[\"editBox\"].getComponent(cc.EditBox);\n        this.roomPrefab.active = false;\n        this.nodeDict[\"search\"].on(\"click\", this.search, this);\n        this.nodeDict[\"quit\"].on(\"click\", this.quit, this);\n\n\n        this.rooms = [];\n\n        clientEvent.on(clientEvent.eventType.getRoomListResponse, this.getRoomListResponse, this);\n        clientEvent.on(clientEvent.eventType.joinRoomResponse, this.joinRoomResponse, this);\n        clientEvent.on(clientEvent.eventType.getRoomListExResponse, this.getRoomListExResponse, this);\n\n        this.getRoomList();\n        this.roomRqId = setInterval(function() {\n            if (this.editBox.string === '') {\n                this.getRoomList();\n            }\n        }.bind(this), 5000);\n    },\n\n    getRoomList: function() {\n        var filter = {\n            maxPlayer: 0,\n            mode: 0,\n            canWatch: 0,\n            roomProperty: \"\",\n            full: 2,\n            state: 1,\n            sort: 1,\n            order: 0,\n            pageNo: 0,\n            pageSize: 20\n        }\n        mvs.engine.getRoomListEx(filter);\n    },\n\n    getRoomListResponse: function(data) {\n        for (var j = 0; j < this.rooms.length; j++) {\n            this.rooms[j].destroy();\n        }\n        this.rooms = [];\n        data.roomInfos.sort(function(a, b) {\n            return a.roomID - b.roomID;\n        });\n        for (var i = 0; i < data.roomInfos.length; i++) {\n            var room = cc.instantiate(this.roomPrefab);\n            room.active = true;\n            room.parent = this.roomPrefab.parent;\n            var roomScript = room.getComponent('roomInfo');\n            roomScript.setData(data.roomInfos[i]);\n\n            this.rooms.push(room);\n        }\n    },\n\n    getRoomListExResponse: function(data) {\n        for (var j = 0; j < this.rooms.length; j++) {\n            this.rooms[j].destroy();\n        }\n        this.rooms = [];\n        this.roomAttrs = data.rsp.roomAttrs;\n        for (var i = 0; i < data.rsp.roomAttrs.length; i++) {\n            var room = cc.instantiate(this.roomPrefab);\n            room.active = true;\n            room.parent = this.roomPrefab.parent;\n            var roomScript = room.getComponent('roomInfo');\n            roomScript.setData(data.rsp.roomAttrs[i]);\n\n            this.rooms.push(room);\n        }\n    },\n\n    quit: function() {\n        clearInterval(this.roomRqId);\n        uiFunc.closeUI(this.node.name);\n        this.node.destroy();\n    },\n\n    search: function() {\n        if (this.editBox.string === '') {\n            for (var i = 0; i < this.rooms.length; i++) {\n                this.rooms[i].active = true;\n            }\n        } else {\n            for (var j = 0; j < this.rooms.length; j++) {\n                var roomScript = this.rooms[j].getComponent('roomInfo');\n                if (roomScript.roomIdLb.string == this.editBox.string) {\n                    this.rooms[j].active = true;\n                } else {\n                    this.rooms[j].active = false;\n                }\n            }\n        }\n    },\n\n    joinRoomResponse: function(data) {\n        if (data.status !== 200) {\n            console.log('进入房间失败,异步回调错误码: ' + data.status);\n        } else {\n            console.log('进入房间成功');\n            console.log('房间号: ' + data.roomInfo.roomID);\n            if (!data.roomUserInfoList.some(function(x) {\n                return x.userId === GLB.userInfo.id;\n            })) {\n                data.roomUserInfoList.push({\n                    userId: GLB.userInfo.id,\n                    userProfile: \"\"\n                });\n            }\n            // 设置房间最大人数--\n            for (var i = 0; i < this.roomAttrs.length; i++) {\n                if (data.roomInfo.roomID === this.roomAttrs[i].roomID) {\n                    GLB.MAX_PLAYER_COUNT = this.roomAttrs[i].maxPlayer;\n                    break;\n                }\n            }\n\n            if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\n                uiFunc.openUI(\"uiRoomVer\", function(obj) {\n                    var room = obj.getComponent('uiRoom');\n                    room.joinRoomInit(data.roomUserInfoList, data.roomInfo);\n                    uiFunc.closeUI(this.node.name);\n                    this.node.destroy();\n                }.bind(this));\n            } else {\n                uiFunc.openUI(\"uiRoom\", function(obj) {\n                    var room = obj.getComponent('uiRoom');\n                    room.joinRoomInit(data.roomUserInfoList, data.roomInfo);\n                    uiFunc.closeUI(this.node.name);\n                    this.node.destroy();\n                }.bind(this));\n            }\n        }\n    },\n\n    onDestroy() {\n        if (window.wx) {\n            wx.offKeyboardComplete();\n            wx.offKeyboardInput();\n            wx.hideKeyboard();\n        }\n        clearInterval(this.roomRqId);\n        clientEvent.off(clientEvent.eventType.getRoomListResponse, this.getRoomListResponse, this);\n        clientEvent.off(clientEvent.eventType.joinRoomResponse, this.joinRoomResponse, this);\n        clientEvent.off(clientEvent.eventType.getRoomListExResponse, this.getRoomListExResponse, this);\n    }\n});\n"]}