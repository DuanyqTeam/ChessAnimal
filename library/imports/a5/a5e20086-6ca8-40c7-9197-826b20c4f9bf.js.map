{"version":3,"sources":["../../../../../assets/common/script/assets/common/script/uiLobbyPanel.js"],"names":["uiPanel","require","mvs","GLB","cc","Class","properties","start","nodeDict","on","randomRoom","createRoom","joinRoom","inviteFriend","exit","getComponent","Label","string","userInfo","id","rank","Game","GameManager","nickName","avatarUrl","loader","load","url","type","err","texture","spriteFrame","SpriteFrame","Rect","width","height","node","Sprite","bind","network","isConnected","connect","IP","PORT","send","blockInput","setTimeout","engine","logout","uiFunc","closeUI","name","destroy","onEnable","isRoomOwner","MAX_PLAYER_COUNT","matchType","RANDOM_MATCH","console","log","gameType","COOPERATION","Canvas","instance","designResolution","openUI","obj","matching","joinRandomRoom","director","loadScene","COMPETITION","window","wx","shareAppMessage","imageUrl"],"mappings":";;;;;;AAAA,IAAIA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAArB;;AACA,IAAIC,GAAG,GAAGD,OAAO,CAAC,SAAD,CAAjB;;AACA,IAAIE,GAAG,GAAGF,OAAO,CAAC,KAAD,CAAjB;;AACAG,EAAE,CAACC,KAAH,CAAS;AACL,aAASL,OADJ;AAGLM,EAAAA,UAAU,EAAE,EAHP;AAKLC,EAAAA,KALK,mBAKG;AACJ,SAAKC,QAAL,CAAc,YAAd,EAA4BC,EAA5B,CAA+B,OAA/B,EAAwC,KAAKC,UAA7C,EAAyD,IAAzD;AACA,SAAKF,QAAL,CAAc,YAAd,EAA4BC,EAA5B,CAA+B,OAA/B,EAAwC,KAAKE,UAA7C,EAAyD,IAAzD;AACA,SAAKH,QAAL,CAAc,UAAd,EAA0BC,EAA1B,CAA6B,OAA7B,EAAsC,KAAKG,QAA3C,EAAqD,IAArD;AACA,SAAKJ,QAAL,CAAc,cAAd,EAA8BC,EAA9B,CAAiC,OAAjC,EAA0C,KAAKI,YAA/C,EAA6D,IAA7D;AACA,SAAKL,QAAL,CAAc,MAAd,EAAsBC,EAAtB,CAAyB,OAAzB,EAAkC,KAAKK,IAAvC,EAA6C,IAA7C;AACA,SAAKN,QAAL,CAAc,MAAd,EAAsBO,YAAtB,CAAmCX,EAAE,CAACY,KAAtC,EAA6CC,MAA7C,GAAsDd,GAAG,CAACe,QAAJ,CAAaC,EAAnE;AACA,SAAKX,QAAL,CAAc,MAAd,EAAsBC,EAAtB,CAAyB,OAAzB,EAAkC,KAAKW,IAAvC,EAA6C,IAA7C;;AACA,QAAIC,IAAI,CAACC,WAAL,CAAiBC,QAArB,EAA+B;AAC3B,WAAKf,QAAL,CAAc,MAAd,EAAsBO,YAAtB,CAAmCX,EAAE,CAACY,KAAtC,EAA6CC,MAA7C,GAAsDI,IAAI,CAACC,WAAL,CAAiBC,QAAvE;AACH,KAFD,MAEO;AACH,WAAKf,QAAL,CAAc,MAAd,EAAsBO,YAAtB,CAAmCX,EAAE,CAACY,KAAtC,EAA6CC,MAA7C,GAAsDd,GAAG,CAACe,QAAJ,CAAaC,EAAnE;AACH;;AACD,QAAIE,IAAI,CAACC,WAAL,CAAiBE,SAArB,EAAgC;AAC5BpB,MAAAA,EAAE,CAACqB,MAAH,CAAUC,IAAV,CAAe;AAACC,QAAAA,GAAG,EAAEN,IAAI,CAACC,WAAL,CAAiBE,SAAvB;AAAkCI,QAAAA,IAAI,EAAE;AAAxC,OAAf,EAA+D,UAASC,GAAT,EAAcC,OAAd,EAAuB;AAClF,YAAIC,WAAW,GAAG,IAAI3B,EAAE,CAAC4B,WAAP,CAAmBF,OAAnB,EAA4B1B,EAAE,CAAC6B,IAAH,CAAQ,CAAR,EAAW,CAAX,EAAcH,OAAO,CAACI,KAAtB,EAA6BJ,OAAO,CAACK,MAArC,CAA5B,CAAlB;;AACA,YAAI,KAAKC,IAAT,EAAc;AACV,eAAK5B,QAAL,CAAc,UAAd,EAA0BO,YAA1B,CAAuCX,EAAE,CAACiC,MAA1C,EAAkDN,WAAlD,GAAgEA,WAAhE;AACH;AACJ,OAL8D,CAK7DO,IAL6D,CAKxD,IALwD,CAA/D;AAMH;;AACD,QAAI,CAACjB,IAAI,CAACC,WAAL,CAAiBiB,OAAjB,CAAyBC,WAAzB,EAAL,EAA6C;AACzCnB,MAAAA,IAAI,CAACC,WAAL,CAAiBiB,OAAjB,CAAyBE,OAAzB,CAAiCtC,GAAG,CAACuC,EAArC,EAAyCvC,GAAG,CAACwC,IAA7C,EAAmD,YAAW;AAC1DtB,QAAAA,IAAI,CAACC,WAAL,CAAiBiB,OAAjB,CAAyBK,IAAzB,CAA8B,8BAA9B,EAA8D;AAC1D,qBAAWzC,GAAG,CAACe,QAAJ,CAAaC,EAAb,GAAkB,EAD6B;AAE1D,qBAAW,GAF+C;AAG1D,sBAAYE,IAAI,CAACC,WAAL,CAAiBC,QAAjB,GAA4BF,IAAI,CAACC,WAAL,CAAiBC,QAA7C,GAAwDpB,GAAG,CAACe,QAAJ,CAAaC,EAAb,GAAkB,EAH5B;AAI1D,sBAAYE,IAAI,CAACC,WAAL,CAAiBE,SAAjB,GAA6BH,IAAI,CAACC,WAAL,CAAiBE,SAA9C,GAA0D;AAJZ,SAA9D;AAMH,OAPD;AAQH;AACJ,GApCI;AAsCLJ,EAAAA,IAAI,EAAE,gBAAW;AACbC,IAAAA,IAAI,CAACC,WAAL,CAAiBuB,UAAjB;;AAEA,QAAI,CAACxB,IAAI,CAACC,WAAL,CAAiBiB,OAAjB,CAAyBC,WAAzB,EAAL,EAA6C;AACzCnB,MAAAA,IAAI,CAACC,WAAL,CAAiBiB,OAAjB,CAAyBE,OAAzB,CAAiCtC,GAAG,CAACuC,EAArC,EAAyCvC,GAAG,CAACwC,IAA7C,EAAmD,YAAW;AACtDtB,QAAAA,IAAI,CAACC,WAAL,CAAiBiB,OAAjB,CAAyBK,IAAzB,CAA8B,8BAA9B,EAA8D;AAC1D,qBAAWzC,GAAG,CAACe,QAAJ,CAAaC,EAAb,GAAkB,EAD6B;AAE1D,qBAAW,GAF+C;AAG1D,sBAAYE,IAAI,CAACC,WAAL,CAAiBC,QAAjB,GAA4BF,IAAI,CAACC,WAAL,CAAiBC,QAA7C,GAAwDpB,GAAG,CAACe,QAAJ,CAAaC,EAAb,GAAkB,EAH5B;AAI1D,sBAAYE,IAAI,CAACC,WAAL,CAAiBE,SAAjB,GAA6BH,IAAI,CAACC,WAAL,CAAiBE,SAA9C,GAA0D;AAJZ,SAA9D;AAMAsB,QAAAA,UAAU,CAAC,YAAW;AAClBzB,UAAAA,IAAI,CAACC,WAAL,CAAiBiB,OAAjB,CAAyBK,IAAzB,CAA8B,mCAA9B,EAAmE;AAC/D,uBAAWzC,GAAG,CAACe,QAAJ,CAAaC,EAAb,GAAkB,EADkC;AAE/D,oBAAQ;AAFuD,WAAnE;AAIH,SALS,EAKP,GALO,CAAV;AAMH,OAbL;AAeH,KAhBD,MAgBO;AACHE,MAAAA,IAAI,CAACC,WAAL,CAAiBiB,OAAjB,CAAyBK,IAAzB,CAA8B,mCAA9B,EAAmE;AAC/D,mBAAWzC,GAAG,CAACe,QAAJ,CAAaC,EAAb,GAAkB,EADkC;AAE/D,gBAAQ;AAFuD,OAAnE;AAIH;AACJ,GA/DI;AAiELL,EAAAA,IAAI,EAAE,gBAAW;AACbZ,IAAAA,GAAG,CAAC6C,MAAJ,CAAWC,MAAX,CAAkB,EAAlB;AACAC,IAAAA,MAAM,CAACC,OAAP,CAAe,KAAKd,IAAL,CAAUe,IAAzB;AACA,SAAKf,IAAL,CAAUgB,OAAV;AACH,GArEI;AAuELC,EAAAA,QAvEK,sBAuEM;AACPlD,IAAAA,GAAG,CAACmD,WAAJ,GAAkB,KAAlB;AACAnD,IAAAA,GAAG,CAACoD,gBAAJ,GAAuB,CAAvB;AACH,GA1EI;AA4EL7C,EAAAA,UAAU,EAAE,sBAAW;AACnBW,IAAAA,IAAI,CAACC,WAAL,CAAiBuB,UAAjB;AAEA1C,IAAAA,GAAG,CAACqD,SAAJ,GAAgBrD,GAAG,CAACsD,YAApB,CAHmB,CAGe;;AAClCC,IAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ;;AACA,QAAIxD,GAAG,CAACyD,QAAJ,KAAiBzD,GAAG,CAAC0D,WAAzB,EAAsC;AAClC,UAAI1D,GAAG,CAACoD,gBAAJ,GAAuB,CAA3B,EAA8B;AAC1B,YAAInD,EAAE,CAAC0D,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoC7B,MAApC,GAA6C/B,EAAE,CAAC0D,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoC9B,KAArF,EAA4F;AACxFe,UAAAA,MAAM,CAACgB,MAAP,CAAc,eAAd,EAA+B,UAASC,GAAT,EAAc;AACzC,gBAAIC,QAAQ,GAAGD,GAAG,CAACnD,YAAJ,CAAiB,YAAjB,CAAf;AACAoD,YAAAA,QAAQ,CAACC,cAAT;AACH,WAHD;AAIH,SALD,MAKO;AACHnB,UAAAA,MAAM,CAACgB,MAAP,CAAc,YAAd,EAA4B,UAASC,GAAT,EAAc;AACtC,gBAAIC,QAAQ,GAAGD,GAAG,CAACnD,YAAJ,CAAiB,YAAjB,CAAf;AACAoD,YAAAA,QAAQ,CAACC,cAAT;AACH,WAHD;AAIH;AACJ,OAZD,MAYO;AACHhE,QAAAA,EAAE,CAACiE,QAAH,CAAYC,SAAZ,CAAsB,MAAtB;AACH;AACJ,KAhBD,MAgBO,IAAInE,GAAG,CAACyD,QAAJ,KAAiBzD,GAAG,CAACoE,WAAzB,EAAsC;AACzC,UAAIpE,GAAG,CAACoD,gBAAJ,KAAyB,CAA7B,EAAgC;AAC5B,YAAInD,EAAE,CAAC0D,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoC7B,MAApC,GAA6C/B,EAAE,CAAC0D,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoC9B,KAArF,EAA4F;AACxFe,UAAAA,MAAM,CAACgB,MAAP,CAAc,kBAAd,EAAkC,UAASC,GAAT,EAAc;AAC5C,gBAAIC,QAAQ,GAAGD,GAAG,CAACnD,YAAJ,CAAiB,kBAAjB,CAAf;AACAoD,YAAAA,QAAQ,CAACC,cAAT;AACH,WAHD;AAIH,SALD,MAKO;AACHnB,UAAAA,MAAM,CAACgB,MAAP,CAAc,eAAd,EAA+B,UAASC,GAAT,EAAc;AACzC,gBAAIC,QAAQ,GAAGD,GAAG,CAACnD,YAAJ,CAAiB,eAAjB,CAAf;AACAoD,YAAAA,QAAQ,CAACC,cAAT;AACH,WAHD;AAIH;AACJ,OAZD,MAYO,IAAIjE,GAAG,CAACoD,gBAAJ,KAAyB,CAA7B,EAAgC;AACnC,YAAInD,EAAE,CAAC0D,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoC7B,MAApC,GAA6C/B,EAAE,CAAC0D,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoC9B,KAArF,EAA4F;AACxFe,UAAAA,MAAM,CAACgB,MAAP,CAAc,kBAAd,EAAkC,UAASC,GAAT,EAAc;AAC5C,gBAAIC,QAAQ,GAAGD,GAAG,CAACnD,YAAJ,CAAiB,kBAAjB,CAAf;AACAoD,YAAAA,QAAQ,CAACC,cAAT;AACH,WAHD;AAIH,SALD,MAKO;AACHnB,UAAAA,MAAM,CAACgB,MAAP,CAAc,kBAAd,EAAkC,UAASC,GAAT,EAAc;AAC5C,gBAAIC,QAAQ,GAAGD,GAAG,CAACnD,YAAJ,CAAiB,kBAAjB,CAAf;AACAoD,YAAAA,QAAQ,CAACC,cAAT;AACH,WAHD;AAIH;AACJ;AACJ;AACJ,GA5HI;AA8HLzD,EAAAA,UAAU,EAAE,sBAAW;AACnB,QAAIP,EAAE,CAAC0D,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoC7B,MAApC,GAA6C/B,EAAE,CAAC0D,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoC9B,KAArF,EAA4F;AACxFe,MAAAA,MAAM,CAACgB,MAAP,CAAc,iBAAd;AACH,KAFD,MAEO;AACHhB,MAAAA,MAAM,CAACgB,MAAP,CAAc,cAAd;AACH;AACJ,GApII;AAsILrD,EAAAA,QAAQ,EAAE,oBAAW;AACjB,QAAIR,EAAE,CAAC0D,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoC7B,MAApC,GAA6C/B,EAAE,CAAC0D,MAAH,CAAUC,QAAV,CAAmBC,gBAAnB,CAAoC9B,KAArF,EAA4F;AACxFe,MAAAA,MAAM,CAACgB,MAAP,CAAc,eAAd;AACH,KAFD,MAEO;AACHhB,MAAAA,MAAM,CAACgB,MAAP,CAAc,YAAd;AACH;AACJ,GA5II;AA8ILpD,EAAAA,YAAY,EAAE,wBAAW;AACrB,QAAG2D,MAAM,CAACC,EAAV,EAAc;AACVA,MAAAA,EAAE,CAACC,eAAH,CAAmB;AAACC,QAAAA,QAAQ,EAAE;AAAX,OAAnB;AACH;AACJ;AAlJI,CAAT","sourceRoot":"../../../../../assets/common/script","sourcesContent":["var uiPanel = require(\"uiPanel\");\nvar mvs = require(\"Matchvs\");\nvar GLB = require(\"Glb\");\ncc.Class({\n    extends: uiPanel,\n\n    properties: {},\n\n    start() {\n        this.nodeDict[\"randomRoom\"].on(\"click\", this.randomRoom, this);\n        this.nodeDict[\"createRoom\"].on(\"click\", this.createRoom, this);\n        this.nodeDict[\"joinRoom\"].on(\"click\", this.joinRoom, this);\n        this.nodeDict[\"inviteFriend\"].on(\"click\", this.inviteFriend, this);\n        this.nodeDict[\"exit\"].on(\"click\", this.exit, this);\n        this.nodeDict[\"name\"].getComponent(cc.Label).string = GLB.userInfo.id;\n        this.nodeDict[\"rank\"].on(\"click\", this.rank, this);\n        if (Game.GameManager.nickName) {\n            this.nodeDict[\"name\"].getComponent(cc.Label).string = Game.GameManager.nickName;\n        } else {\n            this.nodeDict[\"name\"].getComponent(cc.Label).string = GLB.userInfo.id;\n        }\n        if (Game.GameManager.avatarUrl) {\n            cc.loader.load({url: Game.GameManager.avatarUrl, type: 'png'}, function(err, texture) {\n                var spriteFrame = new cc.SpriteFrame(texture, cc.Rect(0, 0, texture.width, texture.height));\n                if (this.node){\n                    this.nodeDict[\"userIcon\"].getComponent(cc.Sprite).spriteFrame = spriteFrame;\n                }\n            }.bind(this));\n        }\n        if (!Game.GameManager.network.isConnected()) {\n            Game.GameManager.network.connect(GLB.IP, GLB.PORT, function() {\n                Game.GameManager.network.send(\"connector.entryHandler.login\", {\n                    \"account\": GLB.userInfo.id + \"\",\n                    \"channel\": \"0\",\n                    \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\n                    \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\n                });\n            });\n        }\n    },\n\n    rank: function() {\n        Game.GameManager.blockInput();\n\n        if (!Game.GameManager.network.isConnected()) {\n            Game.GameManager.network.connect(GLB.IP, GLB.PORT, function() {\n                    Game.GameManager.network.send(\"connector.entryHandler.login\", {\n                        \"account\": GLB.userInfo.id + \"\",\n                        \"channel\": \"0\",\n                        \"userName\": Game.GameManager.nickName ? Game.GameManager.nickName : GLB.userInfo.id + \"\",\n                        \"headIcon\": Game.GameManager.avatarUrl ? Game.GameManager.avatarUrl : \"-\"\n                    });\n                    setTimeout(function() {\n                        Game.GameManager.network.send(\"connector.rankHandler.getRankData\", {\n                            \"account\": GLB.userInfo.id + \"\",\n                            \"game\": \"game8\"\n                        });\n                    }, 500);\n                }\n            );\n        } else {\n            Game.GameManager.network.send(\"connector.rankHandler.getRankData\", {\n                \"account\": GLB.userInfo.id + \"\",\n                \"game\": \"game8\"\n            });\n        }\n    },\n\n    exit: function() {\n        mvs.engine.logout(\"\");\n        uiFunc.closeUI(this.node.name);\n        this.node.destroy();\n    },\n\n    onEnable() {\n        GLB.isRoomOwner = false;\n        GLB.MAX_PLAYER_COUNT = 2;\n    },\n\n    randomRoom: function() {\n        Game.GameManager.blockInput();\n\n        GLB.matchType = GLB.RANDOM_MATCH; // 修改匹配方式为随机匹配\n        console.log('开始随机匹配');\n        if (GLB.gameType === GLB.COOPERATION) {\n            if (GLB.MAX_PLAYER_COUNT > 1) {\n                if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\n                    uiFunc.openUI(\"uiMatchingVer\", function(obj) {\n                        var matching = obj.getComponent(\"uiMatching\");\n                        matching.joinRandomRoom();\n                    });\n                } else {\n                    uiFunc.openUI(\"uiMatching\", function(obj) {\n                        var matching = obj.getComponent(\"uiMatching\");\n                        matching.joinRandomRoom();\n                    });\n                }\n            } else {\n                cc.director.loadScene('game');\n            }\n        } else if (GLB.gameType === GLB.COMPETITION) {\n            if (GLB.MAX_PLAYER_COUNT === 2) {\n                if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\n                    uiFunc.openUI(\"uiMatching1v1Ver\", function(obj) {\n                        var matching = obj.getComponent(\"uiMatching1v1Ver\");\n                        matching.joinRandomRoom();\n                    });\n                } else {\n                    uiFunc.openUI(\"uiMatching1v1\", function(obj) {\n                        var matching = obj.getComponent(\"uiMatching1v1\");\n                        matching.joinRandomRoom();\n                    });\n                }\n            } else if (GLB.MAX_PLAYER_COUNT === 4) {\n                if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\n                    uiFunc.openUI(\"uiMatching2v2Ver\", function(obj) {\n                        var matching = obj.getComponent(\"uiMatching2v2Ver\");\n                        matching.joinRandomRoom();\n                    });\n                } else {\n                    uiFunc.openUI(\"uiMatching2v2Ver\", function(obj) {\n                        var matching = obj.getComponent(\"uiMatching2v2Ver\");\n                        matching.joinRandomRoom();\n                    });\n                }\n            }\n        }\n    },\n\n    createRoom: function() {\n        if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\n            uiFunc.openUI(\"uiCreateRoomVer\");\n        } else {\n            uiFunc.openUI(\"uiCreateRoom\");\n        }\n    },\n\n    joinRoom: function() {\n        if (cc.Canvas.instance.designResolution.height > cc.Canvas.instance.designResolution.width) {\n            uiFunc.openUI(\"uiRoomListVer\");\n        } else {\n            uiFunc.openUI(\"uiRoomList\");\n        }\n    },\n\n    inviteFriend: function() {\n        if(window.wx) {\n            wx.shareAppMessage({imageUrl: \"https://data.tianziyou.com/matchvsGamesRes/logo/animalCheckerLogo1.png\"});\n        }\n    }\n});\n"]}