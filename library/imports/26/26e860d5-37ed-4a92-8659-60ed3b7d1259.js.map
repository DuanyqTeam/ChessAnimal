{"version":3,"sources":["../../../../../assets/common/script/assets/common/script/nextStep.js"],"names":["GLB","require","cc","Class","Component","properties","onLoad","isOpen","isMoving","node","on","touchEvent","event","cb","Game","GameManager","gameState","GameState","Play","user","isMyTurn","isTipSecond","uiFunc","openUI","panel","uiRoundTip","getComponent","setData","ROUND_TIP","OTHER","setTimeout","bind","stopPropagation","isRoomOwner","type","PLAYER_FLAG","BLUE","clientEvent","dispatch","eventType","eatForChess","RED","param","move","callback","checkMoveDirection","msg","action","CHANGE_FLAG","sendEvent","changeFlag","openChessPiece","sign","OPEN_FOR_OTHER","clearMove","setChessType","index","setDestory","active","setPosition","x","y","apply","arguments","getPosition","getIsOpen","getIndex","getTyp","getNode","start","onDestroy","console","log"],"mappings":"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","sourceRoot":"../../../../../assets/common/script","sourcesContent":["var GLB = require(\"Glb\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.isOpen = false;\n        this.isMoving = false;\n        this.node.on('touchend', this.touchEvent, this);\n    },\n\n    touchEvent (event, cb) {\n        if (Game.GameManager.gameState !== GameState.Play) return;\n        // 别人的回合\n        if(!user.isMyTurn) {\n            if(!this.isTipSecond) {\n                uiFunc.openUI('uiRoundTip', function (panel) {\n                    var uiRoundTip = panel.getComponent('uiRoundTip');\n                    uiRoundTip.setData(GLB.ROUND_TIP.OTHER);\n                })\n            }\n            this.isTipSecond = true;\n            setTimeout(function () {\n                this.isTipSecond = false;\n            }.bind(this), 2000);\n            return;\n        }\n        if(event) {\n            event.stopPropagation();\n        }\n\n\n        if (this.isOpen) {\n            //已经翻开\n            if(!GLB.isRoomOwner) {\n                // 蓝色方\n                if (this.type !== GLB.PLAYER_FLAG.BLUE) {\n                    clientEvent.dispatch(clientEvent.eventType.eatForChess, this.node);\n                    return;\n                }\n            } else {\n                // 红色方\n                if (this.type !== GLB.PLAYER_FLAG.RED) {\n                    clientEvent.dispatch(clientEvent.eventType.eatForChess, this.node);\n                    return;\n                }\n            }\n\n            if (this.isMoving === true) {\n                this.isMoving = false;\n            } else {\n                this.isMoving = true;\n            }\n            var param = {\n                node: this.node,\n                move: this.isMoving,\n                callback: cb\n            }\n            clientEvent.dispatch(clientEvent.eventType.checkMoveDirection, param);\n        } else {\n            // 未翻开\n            this.isOpen = true;\n            var msg = {action: GLB.CHANGE_FLAG};\n            Game.GameManager.sendEvent(msg);\n            clientEvent.dispatch(clientEvent.eventType.changeFlag);\n            clientEvent.dispatch(clientEvent.eventType.openChessPiece, this.node.sign);\n        }\n        // user.isMyTurn = false;\n        // TODO 发送翻棋的消息\n        var msg = {action: GLB.OPEN_FOR_OTHER, sign: this.node.sign};\n        Game.GameManager.sendEvent(msg);\n    },\n\n    openChessPiece:function () {\n        this.isOpen = true;\n    },\n\n    clearMove:function() {\n        this.isMoving = false;\n    },\n\n    setChessType:function (type,index) {\n        this.type = type;\n        this.index = index - 1;\n    },\n\n    setDestory:function(){\n        this.node.active = false;\n    },\n\n    setPosition: function(x, y) {\n        this.node.setPosition.apply(this.node, arguments);\n    },\n\n    getPosition () {\n      return this.node.getPosition();\n    },\n\n    getIsOpen:function() {\n        return this.isOpen;\n    },\n\n    getIndex:function() {\n        return this.index + 1;\n    },\n\n    getTyp :function() {\n        return this.type;\n    },\n    getNode:function(){\n        return this.node;\n    },\n\n    start () {\n\n    },\n    onDestroy () {\n        console.log('*****nextStepOndestroy*****')\n       // this.node.off('touchend', this.touchEvent, this);\n    }\n\n    // update (dt) {},\n});\n"]}